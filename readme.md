# âœ… macOS ç¯å¢ƒä¸‹è¿è¡ŒæŒ‡ä»¤

ğŸ”¹ 1. åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆä¾‹å¦‚æ”¾åœ¨æ¡Œé¢ï¼‰

cd ~/Desktop
mkdir chem_lab_system
cd chem_lab_system

ğŸ”¹ 2. å»ºç«‹è™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»ï¼ˆæ¨èï¼‰

python3 -m venv venv
source venv/bin/activate

ğŸ”¹ 3. åˆ›å»ºå¹¶ä¿å­˜ requirements.txt æ–‡ä»¶

nano requirements.txt

å°†ä¸Šæ–¹å†…å®¹ç²˜è´´è¿›å»ï¼Œä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl + O â†’ å›è½¦ï¼ŒCtrl + Xï¼‰ã€‚

ğŸ”¹ 4. å®‰è£…ä¾èµ–

pip install -r requirements.txt

ğŸ”¹ 5. åˆ›å»ºç›®å½•ç»“æ„ï¼ˆå¦‚ä¸Šä¼ ç›®å½•ï¼‰

mkdir -p static/images templates

å°†æˆ‘ä¸Šé¢ç»™å‡ºçš„ Python æ–‡ä»¶ï¼ˆå¦‚ app.pyï¼‰ã€HTML æ¨¡æ¿ï¼ˆå¦‚ templates/base.htmlï¼‰æ”¾å…¥å¯¹åº”è·¯å¾„ã€‚

ğŸ”¹ 6. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆé¦–æ¬¡è¿è¡Œè‡ªåŠ¨ï¼‰

python app.py

ç»ˆç«¯å°†è¾“å‡ºï¼š

 * Running on http://127.0.0.1:5000

æµè§ˆå™¨è®¿é—®ï¼š
ğŸ‘‰ http://127.0.0.1:5000
åˆå§‹é»˜è®¤è´¦å·ä¸ºï¼š

ç”¨æˆ·åï¼šadmin
å¯†ç ï¼šadmin

ğŸ”¹ 7. ç”Ÿäº§æ¨¡å¼å…¬ç½‘å¯åŠ¨

flask run --host=0.0.0.0 --port=5000

gunicorn -w 3 -b 0.0.0.0:5000 app:app

gunicorn -w 2 -k gthread --threads 6 -b 0.0.0.0:8000 app:app \
  --timeout 120 --access-logfile - --error-logfile -
â¸»

ğŸ”’ å…¶ä»–å»ºè®®

åŠŸèƒ½	è¯´æ˜
ä¸Šä¼ å›¾ç‰‡å¤§å°é™åˆ¶	é»˜è®¤æœ€å¤§ 16MBï¼Œå¯é€šè¿‡ app.config['MAX_CONTENT_LENGTH'] è°ƒæ•´
é™æ€æ–‡ä»¶è·¯å¾„	æ‰€æœ‰ä¸Šä¼ å›¾ç‰‡ä¿å­˜åœ¨ static/images/ ç›®å½•
æ•°æ®å¤‡ä»½å¯¼å‡º	æ”¯æŒé€šè¿‡ /export/items ç­‰è·¯å¾„å¯¼å‡º CSV æ–‡ä»¶
ç”Ÿäº§éƒ¨ç½²å»ºè®®	ä½¿ç”¨ gunicorn + Nginx å®ç°åç«¯éƒ¨ç½²


â¸»

# âœ… ä¸€é”®ä¸Šä¼ é¡¹ç›®åˆ° GitHub çš„å®Œæ•´æ­¥éª¤

ä½ å·²ç»åœ¨æœ¬åœ°æœ‰äº†é¡¹ç›®ç›®å½•ï¼Œæ¯”å¦‚ï¼š~/Desktop/Benlab
å¹¶ä¸”ä½ å·²åœ¨è¯¥è·¯å¾„è¿è¡Œè¿‡ Flask é¡¹ç›®ï¼ˆä¾‹å¦‚åŒ…å« app.pyã€templates/ ç­‰ï¼‰ã€‚

ğŸ”¹ 1. æ‰“å¼€ç»ˆç«¯å¹¶è¿›å…¥é¡¹ç›®ç›®å½•

cd ~/Desktop/Benlab


â¸»

ğŸ”¹ 2. åˆå§‹åŒ– Git å¹¶æ·»åŠ è¿œç¨‹ä»“åº“

git init
git remote add origin https://github.com/Benjaminisgood/Benlab.git


â¸»

ğŸ”¹ 3. æ·»åŠ  .gitignore æ–‡ä»¶ï¼ˆå¿½ç•¥è™šæ‹Ÿç¯å¢ƒç­‰ï¼‰

echo "venv/" > .gitignore
echo "__pycache__/" >> .gitignore
echo "*.pyc" >> .gitignore
echo "*.sqlite3" >> .gitignore

æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªæ¨èæ¨¡æ¿ï¼šPython .gitignore æ¨¡æ¿

â¸»

ğŸ”¹ 4. æ·»åŠ é¡¹ç›®æ‰€æœ‰æ–‡ä»¶å¹¶æäº¤

git add .
git commit -m "ğŸ‰ Initial commit of chemical lab management system"


â¸»

ğŸ”¹ 5. æ¨é€åˆ° GitHub ä¸»åˆ†æ”¯ main

git branch -M main
git push -u origin main


â¸»

âœ… æœ€ç»ˆç»“æ„åº”ç±»ä¼¼ï¼š

Benlab/
â”œâ”€â”€ app.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html
â”‚   â”œâ”€â”€ login.html
â”‚   â”œâ”€â”€ items.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ static/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ .gitignore
â””â”€â”€ venv/  â† å·²è¢«å¿½ç•¥


â¸»

âœ… ä¹‹åæ›´æ–°é¡¹ç›®çš„æ–¹æ³•ï¼ˆå‘½ä»¤å›é¡¾ï¼‰

æ¯æ¬¡æ›´æ–°åï¼š

git add .
git commit -m "âœ¨ æ›´æ–°å†…å®¹è¯´æ˜"
git push

â¸»

ğŸ§ª Flask-Migrate æ•°æ®åº“è¿ç§»æµç¨‹

âœ… æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–

pip install flask-migrate

ç¡®ä¿ä½ çš„è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼Œå¦åˆ™å°±ä¼šè£…åˆ°å…¨å±€ç¯å¢ƒé‡Œã€‚

â¸»

âœ… æ­¥éª¤ 2ï¼šä¿®æ”¹ app.py æ”¯æŒ Flask-Migrate

åœ¨ app.py é‡ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼ˆä½ å·²å†™äº† db = SQLAlchemy(app)ï¼‰ï¼š

from flask_migrate import Migrate

# åœ¨ db åˆå§‹åŒ–ä¹‹ååŠ 
migrate = Migrate(app, db)


â¸»

âœ… æ­¥éª¤ 3ï¼šåˆå§‹åŒ–è¿ç§»ç›®å½•

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

export FLASK_APP=app.py  # Mac/Linux
# set FLASK_APP=app.py  # Windows

flask db init

ä¼šåˆ›å»ºä¸€ä¸ª migrations/ æ–‡ä»¶å¤¹ç”¨äºè·Ÿè¸ªè¿ç§»å†å²ã€‚

â¸»

âœ… æ­¥éª¤ 4ï¼šç”Ÿæˆåˆå§‹è¿ç§»è„šæœ¬

flask db migrate -m "Initial migration"

è¿™ä¸€æ­¥ä¼šæ ¹æ®æ¨¡å‹å˜åŒ–è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆä¸ä¼šç«‹å³ä¿®æ”¹æ•°æ®åº“ï¼‰ã€‚

â¸»

âœ… æ­¥éª¤ 5ï¼šåº”ç”¨è¿ç§»åˆ°æ•°æ®åº“

flask db upgrade

è¿™ä¸€æ­¥ä¼šæ ¹æ®ä¸Šä¸€æ­¥ç”Ÿæˆçš„è„šæœ¬ä¿®æ”¹ä½ çš„ SQLite æ•°æ®åº“ç»“æ„ï¼Œæ–°å¢å­—æ®µå¦‚ stock_status, features, value ç­‰å°±ä¼šæ­£å¼åŠ å…¥æ•°æ®åº“ç»“æ„ä¸­ã€‚

â¸»

ğŸ“Œ æ³¨æ„äº‹é¡¹
	â€¢	ä¹‹åä½ æ¯æ¬¡ä¿®æ”¹æ¨¡å‹ç±»ï¼ˆä¾‹å¦‚æ·»åŠ å­—æ®µï¼‰ï¼Œéƒ½åº”è¯¥æ‰§è¡Œï¼š

flask db migrate -m "Added xxx"
flask db upgrade

	â€¢	å¦‚æœæŠ¥é”™ â€œtarget database is not up to dateâ€ï¼Œå¯ä»¥ç”¨ï¼š

flask db stamp head

cd /Users/benserver/Desktop/Benlab
gunicorn -w 4 -k gevent --worker-connections 1000 \
  -b 0.0.0.0:8000 "app:app" \
  --timeout 120 --access-logfile - --error-logfile -


gunicorn -w 2 -k gthread --threads 6 -b 0.0.0.0:8000 app:app \
  --timeout 120 --access-logfile - --error-logfile -


# 1) å®‰è£…
pip install "gunicorn>=21" "gevent>=24"

# 2) å®‰å…¨å˜é‡
export FLASK_SECRET_KEY="$(python - <<'PY'
import secrets; print(secrets.token_urlsafe(32))
PY
)"

# 3) å¯åŠ¨ï¼ˆæœ¬æœºæœåŠ¡å™¨ï¼‰
cd /Users/benserver/Desktop/Benlab
gunicorn -w 4 -k gevent --worker-connections 1000 \
  -b 0.0.0.0:8000 "app:app" \
  --timeout 120 --access-logfile - --error-logfile -










# åŒ–å­¦å®éªŒå®¤ç®¡ç†ç³»ç»Ÿå¼€å‘æŒ‡å—
æœ¬ç³»ç»Ÿæ—¨åœ¨ä¸ºåŒ–å­¦å®éªŒå®¤æä¾›ä¸€ä¸ªåŸºäº Flask çš„ç®¡ç†å¹³å°ï¼Œæ¶µç›–è¯¾é¢˜ç»„ç‰©å“ç®¡ç†ã€è¯¾é¢˜ç»„æˆå‘˜ç®¡ç†å’Œå®éªŒå®¤ä½ç½®ç®¡ç†ä¸‰ä¸ªä¸»è¦æ¨¡å—ã€‚å‰ç«¯é‡‡ç”¨ HTML/CSSï¼ˆå¯å€ŸåŠ© Bootstrap ç­‰å‰ç«¯æ¡†æ¶ç»Ÿä¸€æ ·å¼ï¼‰ï¼Œåç«¯ä½¿ç”¨ Python Flask å®ç°ä¸šåŠ¡é€»è¾‘ã€‚åŸºæœ¬æ•°æ®å­˜å‚¨é‡‡ç”¨è½»é‡çº§çš„ SQLite æ•°æ®åº“ï¼Œå¹¶é€šè¿‡ Pandas åº“æ¥è¯»å–å’Œç®¡ç†æ•°æ®å®ç°æ¨¡å—åŠŸèƒ½ ï¿¼ã€‚ç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·ç™»å½•ï¼ˆæ— éœ€å•ç‹¬çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ¯ä½è¯¾é¢˜ç»„æˆå‘˜å‡­è´¦å·ç™»å½•ï¼‰ï¼Œå®ç°ç‰©å“ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥ã€æˆå‘˜ä¸ªäººä¸»é¡µåŠé€šçŸ¥ã€å®éªŒå®¤ä½ç½®çš„å¯è§†åŒ–æ ‡æ³¨ç­‰åŠŸèƒ½ã€‚å›¾ç‰‡ä¸Šä¼ å’Œé¢„è§ˆä¹Ÿæ˜¯ç³»ç»Ÿçš„ä¸€é¡¹é‡è¦åŠŸèƒ½ï¼šç”¨æˆ·å¯ç›´æ¥é€šè¿‡ç½‘é¡µè¡¨å•è°ƒç”¨æ‘„åƒå¤´æ‹ç…§ä¸Šä¼ å®éªŒå®¤ç‰©å“æˆ–ä½ç½®å›¾ç‰‡ï¼Œå¹¶åœ¨ä¸Šä¼ åå³æ—¶é¢„è§ˆæ•ˆæœã€‚ ï¿¼

æ€»ä½“è€Œè¨€ï¼Œè¯¥ç³»ç»Ÿå°†å®éªŒå®¤æ—¥å¸¸ç®¡ç†çš„ä¸‰ä¸ªæ–¹é¢èåˆåœ¨ä¸€ä¸ªå¹³å°ä¸Šï¼šç‰©å“å°è´¦ã€äººå‘˜ä¿¡æ¯å’Œå®éªŒå®¤ç©ºé—´ä½ç½®ã€‚å„æ¨¡å—æ•°æ®ç›¸å…³è”ï¼Œå¹¶åœ¨ç•Œé¢ä¸Šæä¾›ä¾¿æ·çš„äº¤äº’ã€‚ä¾‹å¦‚ï¼Œå½“æŸç‰©å“ä¿¡æ¯æ›´æ–°æ—¶ï¼Œç›¸å…³è´Ÿè´£äººä¼šåœ¨å…¶ä¸ªäººä¸»é¡µæ”¶åˆ°é€šçŸ¥æé†’ï¼›å½“ç”¨æˆ·åœ¨åº“å­˜ä¸­æœç´¢åˆ°æŸåŒ–å­¦å“æ—¶ï¼Œå¯ç›´æ¥æŸ¥çœ‹å…¶å­˜æ”¾çš„å…·ä½“å®éªŒå®¤ä½ç½®å›¾ã€‚æ¥ä¸‹æ¥å°†è¯¦ç»†ä»‹ç»ç³»ç»Ÿçš„æ•°æ®è®¾è®¡ã€åŠŸèƒ½æ¨¡å—å’Œå®ç°ç»†èŠ‚ã€‚

## æŠ€æœ¯æ ˆ

åç«¯ï¼šFlaskï¼ˆPython æ¡†æ¶ï¼‰
å‰ç«¯ï¼šHTMLã€CSSï¼Œæ¨èä½¿ç”¨ Bootstrap å®ç°å“åº”å¼ UI
æ•°æ®åº“ï¼šSQLiteï¼ˆè½»é‡çº§æ•°æ®åº“ï¼Œé€‚åˆå°å‹å›¢é˜Ÿï¼‰
æ•°æ®å¤„ç†ï¼šPandasï¼ˆç”¨äºæ•°æ®å¯¼å…¥/å¯¼å‡ºæˆ–åˆ†æï¼‰
å…¶ä»–ï¼šFlask-SQLAlchemyï¼ˆORM å·¥å…·ï¼‰ã€Flask-Loginï¼ˆç”¨æˆ·è®¤è¯ï¼‰ã€Werkzeugï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰

## æ•°æ®æ¨¡å‹
ç³»ç»Ÿä½¿ç”¨ SQLite ä½œä¸ºåŸºç¡€æ•°æ®åº“ï¼Œç»“åˆ Pandas åº“å¯¹æ•°æ®è¿›è¡Œç®¡ç†å’Œæ“ä½œ ï¿¼ã€‚ç³»ç»Ÿç®¡ç†ä¸‰ä¸ªä¸»è¦å®ä½“ï¼šè¯¾é¢˜ç»„æˆå‘˜ã€è¯¾é¢˜ç»„ç‰©å“å’Œå®éªŒå®¤ä½ç½®ï¼Œæ¯ä¸ªå®ä½“åŒ…å«å›¾ç‰‡è·¯å¾„ã€å¤‡æ³¨å’Œä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰å¼ æ•°æ®è¡¨ï¼š
	â€¢	è¯¾é¢˜ç»„æˆå‘˜è¡¨ï¼ˆMembersï¼‰ï¼šå­—æ®µåŒ…æ‹¬member_id(ä¸»é”®)ã€å§“åã€ç™»å½•ç”¨æˆ·åã€å¯†ç å“ˆå¸Œã€è”ç³»æ–¹å¼ç­‰åŸºæœ¬ä¿¡æ¯ï¼Œä»¥åŠä¸ªäººç…§ç‰‡è·¯å¾„ï¼ˆå­˜å‚¨åœ¨æœåŠ¡å™¨æŒ‡å®šçš„å›¾ç‰‡ç›®å½•ï¼‰ã€å¤‡æ³¨ã€æœ€åä¿®æ”¹æ—¶é—´ç­‰ã€‚æˆå‘˜è¡¨çš„è®°å½•ä»£è¡¨å®éªŒå®¤çš„æ¯ä¸ªæˆå‘˜è´¦å·ã€‚

	â€¢	è¯¾é¢˜ç»„ç‰©å“è¡¨ï¼ˆItemsï¼‰ï¼šå­—æ®µåŒ…æ‹¬item_id(ä¸»é”®)ã€ç‰©å“åç§°ã€ç‰©å“ç±»åˆ«æˆ–å±é™©çº§åˆ«ã€å½“å‰çŠ¶æ€ã€è´Ÿè´£äººå‘˜ï¼ˆå¤–é”®å…³è”åˆ°æˆå‘˜è¡¨ï¼‰ã€å­˜æ”¾ä½ç½®ï¼ˆå¤–é”®å…³è”åˆ°ä½ç½®è¡¨ï¼‰ã€ç‰©å“å›¾ç‰‡è·¯å¾„ã€å¤‡æ³¨è¯´æ˜ã€æœ€åä¿®æ”¹æ—¶é—´ã€è´­ä¹°é“¾æ¥ç­‰ã€‚ç‰©å“çš„â€œçŠ¶æ€â€å­—æ®µå¯ä»¥ç”¨æ¥æè¿°åº“å­˜é‡ä»¥åŠå®‰å…¨ç¨‹åº¦ç­‰ç­‰ï¼Œä¾‹å¦‚å……è¶³ã€å°‘é‡ã€ç”¨å®Œè¡¨ç¤ºåº“å­˜é‡çŠ¶æ€ï¼Œæˆ–è€…å®‰å…¨ã€ä¸€èˆ¬ã€å±é™©ã€æ˜‚è´µç­‰æ ‡ç­¾æè¿°ç‰©å“ç‰¹æ€§ã€‚å¯ä»¥å¯¹è¿™äº›ç‰¹æ€§è¿›è¡Œç­›é€‰ï¼Œå¿«é€Ÿæ‰¾å‡ºå¯¹åº”çš„ç‰©å“ã€‚

	â€¢	å®éªŒå®¤ä½ç½®è¡¨ï¼ˆLocationsï¼‰ï¼šå­—æ®µåŒ…æ‹¬location_idã€ä½ç½®åç§°ï¼ˆå¦‚â€œè¯•å‰‚æŸœAâ€æˆ–â€œå®éªŒå®¤ä¸œåŒºâ€ï¼‰ã€è´Ÿè´£äººå‘˜ï¼ˆæˆå‘˜è¡¨å¤–é”®å…³è”ï¼‰ã€å­˜æœ‰çš„ç‰©å“ï¼ˆå¤–é”®å…³è”åˆ°ç‰©å“è¡¨ï¼‰ã€ä½ç½®å›¾ç‰‡è·¯å¾„ã€å¤‡æ³¨ã€æœ€åä¿®æ”¹æ—¶é—´ç­‰ã€‚ä½ç½®è¡¨çš„æ¯æ¡è®°å½•ä»£è¡¨å®éªŒå®¤çš„ä¸€ä¸ªå­˜å‚¨åŒºåŸŸæˆ–æˆ¿é—´ã€‚
    
    
ä¸Šè¿°æ‰€æœ‰è¡¨çš„å›¾ç‰‡æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨æœåŠ¡å™¨çš„ä¸€ä¸ªç›®å½•ä¸‹ï¼ˆå¦‚static/images/ï¼‰ï¼Œæ•°æ®åº“ä¸­ä»…ä¿å­˜å›¾ç‰‡çš„æ–‡ä»¶è·¯å¾„æˆ–æ–‡ä»¶åã€‚æ³¨æ„ï¼šå°†å›¾ç‰‡äºŒè¿›åˆ¶ç›´æ¥ä¿å­˜åˆ°æ•°æ®åº“å¹¶éæœ€ä½³å®è·µï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´æ•°æ®åº“ä½“ç§¯è†¨èƒ€å¹¶å½±å“æŸ¥è¯¢æ€§èƒ½ï¼Œé€šå¸¸å»ºè®®å°†å›¾ç‰‡ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ•°æ®åº“ä¸­ä»…å­˜å‚¨å›¾ç‰‡çš„è·¯å¾„æˆ– URL ï¿¼ã€‚æœ¬ç³»ç»Ÿéµå¾ªè¿™ä¸€åŸåˆ™ï¼Œæ¯æ¬¡æœ‰å›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ°æœåŠ¡å™¨æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è·¯å¾„è®°å½•åœ¨ç›¸åº”çš„æ•°æ®è¡¨å­—æ®µä¸­ã€‚

é™¤äº†ä¿®æ”¹ä¸é¢‘ç¹çš„è¿™äº›åŸºæœ¬æ•°æ®ç”¨sqliteä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½ä½¿ç”¨pandasæ¥ç®¡ç†ï¼Œä»¥å®ç°ä¸‰ä¸ªç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ï¼Œè¿™æ ·ä¸ä»…åœ¨å¼€å‘ä¸­é€šè¿‡ Pandas æ¥ç®€åŒ–å¯¹ SQLite æ•°æ®çš„æ“ä½œï¼Œå‡å°‘äº†ç›´æ¥å†™ SQL æŸ¥è¯¢çš„ç¹çï¼Œè€Œä¸”è¿˜å®ç°â€œæ‰€è§å³æ‰€å¾—â€çš„æ•°æ®å¤„ç†æµç¨‹ï¼ˆæ­£å¦‚ä¸€ä¸ªå¼€æºå®éªŒå®¤åº“å­˜ç³»ç»Ÿæ‰€åšçš„ï¼šå…ˆç”¨ CSV å‡†å¤‡æ•°æ®ï¼Œå†é€šè¿‡è„šæœ¬å¯¼å…¥ SQLiteï¼Œæ— éœ€äº†è§£ SQL ï¿¼ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†sqliteé‡Œçš„é‚£äº›å¯¹ç³»ç»Ÿçº§åŸºæœ¬æ•°æ®çš„å­˜å‚¨å¤–ï¼Œä¸‰ä¸ªç³»ç»Ÿçš„åŠŸèƒ½å®ç°éœ€è¦é¢å¤–çš„pandaåˆ¶è¡¨ã€‚åˆ¶ä½œçš„å¤šå¼ è¡¨æ ¼éœ€è¦å¯ä»¥å¯¼å‡ºå’Œä¸‹è½½ã€‚éœ€è¦æ³¨æ„ï¼Œä¸è¦ç›´æ¥ç”¨ to_sql å…¨è¡¨æ›¿æ¢çš„æ–¹å¼æ›´æ–°æ•°æ®ï¼Œåœ¨å¤šç”¨æˆ·å¹¶å‘æ—¶å¯èƒ½è¦†ç›–ä»–äººæ”¹åŠ¨ã€‚ä¸‹åˆ—æ˜¯å…·ä½“å®ç°ï¼š

ç”±äºéœ€è¦åœ¨å›¾ç‰‡ä¸Šæ ‡è®°ç‰©å“ä½ç½®ï¼Œè¿˜éœ€å­˜å‚¨ç›¸å…³çš„åæ ‡æ•°æ®ï¼šæ–¹å¼æ˜¯é€šè¿‡ç½‘é¡µå’Œpandasè¡¨æ ¼ï¼Œè·å–æ­¤ä½ç½®çš„æ‰€æœ‰ç‰©å“ä¿¡æ¯ï¼Œé€šè¿‡æ‹–æ‹½èµ‹äºˆä½ç½®åæ ‡ï¼Œå¦‚pos_xå’Œpos_yï¼Œç”¨äºè®°å½•è¯¥ç‰©å“åœ¨å…¶æ‰€åœ¨ä½ç½®å›¾ç‰‡ä¸­çš„åæ ‡ï¼ˆç›¸å¯¹äºå›¾ç‰‡çš„ç™¾åˆ†æ¯”æˆ–åƒç´ å€¼ï¼‰ã€‚è¿™æ ·æ¯ä»¶ç‰©å“éƒ½èƒ½åœ¨å¯¹åº”ä½ç½®çš„å›¾ç‰‡ä¸Šä»¥å›¾é’‰å½¢å¼å±•ç¤ºã€‚è¿™å°±éœ€è¦ä¸€å¼ è¡¨æ ¼ã€‚

å†æ¯”å¦‚æ‰€æœ‰ç”¨æˆ·äº§ç”Ÿçš„è¡Œä¸ºè®°å½•Logsï¼Œä¹Ÿéœ€è¦é¢å¤–çš„è¡¨æ ¼æ¥è®°å½•ï¼Œè¿™æ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹è¿™äº›çŸ­æ—¶æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œå¯¼å‡ºå¤‡ä»½ç­‰ç­‰ã€‚å¹¶ä¸”æå…¶å®¹æ˜“æŸ¥çœ‹å’Œä¾›æ— ç¼–ç¨‹åŸºç¡€çš„äººç¼–è¾‘ã€‚è¿™å¤§æ¦‚éœ€è¦id (ä¸»é”®), timestamp, user_id (å¤–é”®), action_type, detailsç­‰ã€‚

å†æ¯”å¦‚ç”¨æˆ·ä¹‹é—´çš„ç•™è¨€æ¿ï¼Œä¹Ÿéœ€è¦æœ‰ä¸‹åˆ—çš„åˆ—è¡¨ï¼š
Messages
id (ä¸»é”®), sender_id (å¤–é”®), content, timestamp

å…¶ä»–è¿˜æœ‰ä¸€äº›ä¸å¤ªé‡è¦çš„ç»†èŠ‚ï¼Œaiè‡ªå·±å†³ç­–ã€‚

## åŠŸèƒ½éœ€æ±‚

### ç‰©å“ç®¡ç†å­ç³»ç»Ÿ

ç‰©å“ç®¡ç†æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œæ”¯æŒå¯¹è¯¾é¢˜ç»„ç‰©èµ„ï¼ˆè¯•å‰‚ã€è€—æã€ä»ªå™¨ç­‰ï¼‰çš„å¢åˆ æ”¹æŸ¥å’ŒçŠ¶æ€è·Ÿè¸ªã€‚é€šè¿‡ç½‘é¡µç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥æµè§ˆæ‰€æœ‰ç‰©å“æ¸…å•ã€æ£€ç´¢ç‰¹å®šç‰©å“ï¼Œå¹¶å¯¹ç‰©å“ä¿¡æ¯è¿›è¡Œç¼–è¾‘æˆ–æ–°å¢è®°å½•ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å…³é”®å­—ï¼ˆå¦‚åç§°çš„ä¸€éƒ¨åˆ†ï¼‰ç­›é€‰ç‰©å“ï¼Œå¹¶æŒ‰ç±»åˆ«ï¼ˆåŒ–å­¦å“ã€è€—æã€è®¾å¤‡ç­‰ï¼‰è¿›è¡Œè¿‡æ»¤ã€‚ç‰©å“åˆ—è¡¨ä»¥è¡¨æ ¼å½¢å¼å‘ˆç°ï¼Œæ¯è¡Œæ˜¾ç¤ºç‰©å“åç§°ã€æ•°é‡æˆ–çŠ¶æ€ã€å­˜æ”¾ä½ç½®ä»¥åŠå­˜æ”¾ä½ç½®çš„å…·ä½“åŒºåŸŸï¼ˆå¦‚æŸœå­/æŠ½å±‰ï¼‰ç­‰ä¿¡æ¯ã€‚è¿™æ ·çš„ç•Œé¢æ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿæ‰«æåº“å­˜è¯¦æƒ… ï¿¼ã€‚åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œä¹Ÿä¼šæä¾›ç±»ä¼¼çš„ç‰©å“åˆ—è¡¨è§†å›¾ï¼Œå¹¶æ ¹æ®ç‰©å“çš„çŠ¶æ€ç»™äºˆä¸åŒçš„è§†è§‰æ ‡è¯†ï¼ˆä¾‹å¦‚â€œç”¨å®Œâ€çŠ¶æ€çš„ç‰©å“ç”¨çº¢è‰²é«˜äº®ï¼‰ã€‚

æ¯ä¸ªç‰©å“è®°å½•åŒ…å«å¦‚ä¸‹ä¸»è¦ä¿¡æ¯ï¼šåç§°ã€çŠ¶æ€ã€è´Ÿè´£äººã€å­˜æ”¾ä½ç½®ã€ä¸Šæ¬¡æ›´æ–°æ—¶é—´ã€å¤‡æ³¨ï¼Œä»¥åŠå…³è”çš„å›¾ç‰‡ï¼ˆå¦‚åŒ–å­¦å“ç“¶å­çš„ç…§ç‰‡æˆ–æ ‡ç­¾ï¼‰ã€‚ç”¨æˆ·ç‚¹å‡»æŸä¸€ç‰©å“åç§°ï¼Œå¯è¿›å…¥è¯¥ç‰©å“çš„è¯¦æƒ…é¡µé¢æˆ–ç¼–è¾‘é¡µé¢ï¼Œåœ¨é‚£é‡Œå¯ä»¥æŸ¥çœ‹å®Œæ•´ä¿¡æ¯å¹¶æ‰§è¡Œä¿®æ”¹ã€‚ç¼–è¾‘è¡¨å•å…è®¸æ›´æ–°ä¸Šè¿°å„å­—æ®µâ€”â€”å…¶ä¸­çŠ¶æ€å­—æ®µå¯ä»é¢„å®šä¹‰é€‰é¡¹é€‰æ‹©ï¼Œä¾‹å¦‚åº“å­˜é‡çŠ¶æ€ï¼ˆå……è¶³/å°‘é‡/ç”¨å®Œï¼‰æˆ–å±é™©çº§åˆ«ï¼ˆå®‰å…¨/ä¸€èˆ¬/å±é™©/æ˜‚è´µç­‰ï¼‰ã€‚è´Ÿè´£äººå­—æ®µé€šå¸¸æ˜¯ä»æˆå‘˜åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œå°†ç‰©å“è´£ä»»å½’å±åˆ°å…·ä½“çš„äººã€‚

æ£€ç´¢ä¸ç­›é€‰åŠŸèƒ½ï¼š ç”¨æˆ·å¯ä»¥é€šè¿‡æœç´¢æ¡†æŒ‰åç§°ã€ç±»åˆ«æˆ–è´Ÿè´£äººæ¥æ£€ç´¢ç‰©å“ã€‚å®ç°ä¸Šï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯åˆ©ç”¨ Pandas å¯¹ç‰©å“ DataFrame è¿›è¡Œè¿‡æ»¤ï¼Œæ ¹æ®æŸ¥è¯¢å­—ç¬¦ä¸²åŒ¹é…åç§°æˆ–å…¶ä»–å­—æ®µï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™æ¨¡æ¿æ¸²æŸ“ã€‚å¦‚æœæ•°æ®é›†è¾ƒå¤§ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ AJAX ç»“åˆå‰ç«¯è„šæœ¬å®ç°åŠ¨æ€æœç´¢æç¤ºã€‚ç®€å•æƒ…å†µä¸‹ï¼Œåœ¨ Flask è·¯ç”±ä¸­è·å–æœç´¢å‚æ•°åï¼Œç”¨ DataFrame çš„å¸ƒå°”ç´¢å¼•ç­›é€‰ï¼Œå†å°†ç­›é€‰ç»“æœè½¬ä¸ºåˆ—è¡¨ä¾›æ¨¡æ¿æ˜¾ç¤ºå³å¯ã€‚

å¢åˆ æ”¹æ“ä½œï¼š ç³»ç»Ÿæä¾›â€œæ–°å¢ç‰©å“â€å…¥å£ï¼Œç‚¹å‡»åè·³è½¬åˆ°ç‰©å“ä¿¡æ¯å½•å…¥è¡¨å•é¡µé¢ã€‚è¾“å…¥åŒ…æ‹¬ç‰©å“åç§°ã€é€‰æ‹©è´Ÿè´£äººã€é€‰æ‹©å­˜æ”¾ä½ç½®ï¼ˆå¯ä»å·²æœ‰ä½ç½®åˆ—è¡¨ä¸­é€‰æ‹©ï¼‰ã€çŠ¶æ€ã€å¤‡æ³¨ï¼Œä»¥åŠä¸Šä¼ ç‰©å“å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰ã€‚æäº¤åï¼Œç”± Flask åç«¯æ¥æ”¶è¡¨å•æ•°æ®ï¼Œé€šè¿‡ SQL INSERT æˆ– Pandas å°†æ–°è®°å½•åŠ å…¥æ•°æ®åº“ï¼Œå¹¶è®°å½•å½“å‰æ—¶é—´ä¸ºæœ€åæ›´æ–°æ—¶é—´ã€‚ç¼–è¾‘ç‰©å“æ—¶æµç¨‹ç±»ä¼¼ï¼Œåªæ˜¯å…ˆè¯»å‡ºæ—§æ•°æ®å¡«å……è¡¨å•ï¼Œç”¨æˆ·ä¿®æ”¹åæäº¤ï¼Œåç«¯æ‰§è¡Œ UPDATEã€‚åˆ é™¤ç‰©å“æ“ä½œå¯æ ¹æ®éœ€è¦æä¾›ï¼Œä¸€èˆ¬åœ¨åˆ—è¡¨é¡µé¢ä¸ºæ¯æ¡è®°å½•æä¾›â€œåˆ é™¤â€æŒ‰é’®ï¼Œç‚¹é€‰åå¼¹å‡ºç¡®è®¤ï¼Œå†ç”±åç«¯æ‰§è¡Œ DELETE è¯­å¥ç§»é™¤è®°å½•ã€‚

åä½œç¼–è¾‘ä¸é€šçŸ¥ï¼š ç”±äºæ²¡æœ‰ä¸“é—¨ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ‰€æœ‰è¯¾é¢˜ç»„æˆå‘˜éƒ½å¯ä»¥å‚ä¸ç‰©å“ä¿¡æ¯çš„ç»´æŠ¤ã€‚è¿™è¦æ±‚ä¸€å®šçš„æ“ä½œè®°å½•å’Œæé†’æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œå½“æŸç”¨æˆ·ä¿®æ”¹äº†ä¸€ä»¶ä»–äººè´Ÿè´£çš„ç‰©å“æ—¶ï¼Œç³»ç»Ÿåº”è®°å½•è¿™ä¸€æ“ä½œï¼Œå¹¶åœ¨ç‰©å“è¯¦æƒ…æˆ–è´Ÿè´£äººçš„ä¸»é¡µä¸Šæ˜¾ç¤ºè¯¥ä¿®æ”¹è®°å½•ã€‚å®ç°æ–¹å¼æ˜¯åœ¨æ¯æ¬¡ä¿®æ”¹ç‰©å“æ—¶ï¼Œåœ¨â€œæœ€è¿‘æ›´æ–°æ—¶é—´â€å’Œâ€œæœ€è¿‘æ›´æ–°äººâ€ç­‰å­—æ®µæ›´æ–°ä¹‹å¤–ï¼Œå‘æ—¥å¿—è¡¨æ’å…¥ä¸€æ¡è®°å½•ï¼ŒåŒ…æ‹¬ç‰©å“IDã€æ“ä½œäººã€æ—¶é—´å’ŒåŠ¨ä½œç±»å‹ï¼ˆä¿®æ”¹/æ–°å¢/åˆ é™¤ï¼‰ã€‚æ—¥å¿—æ•°æ®å¯ç”¨äºç¨åæˆå‘˜ä¸»é¡µçš„é€šçŸ¥å±•ç¤ºã€‚è´Ÿè´£äººçœ‹åˆ°æœ‰äººæ›´æ–°äº†è‡ªå·±è´Ÿè´£çš„ç‰©å“æ—¶ï¼Œå¯ä»¥åŠæ—¶çŸ¥æ™“å˜æ›´ã€‚


### ç»„å‘˜ç®¡ç†å­ç³»ç»Ÿ

ç»„å‘˜ç®¡ç†æ¨¡å—ä¸»è¦é¢å‘æ¯ä¸ªè¯¾é¢˜ç»„æˆå‘˜çš„ä¸ªäººä¿¡æ¯å’ŒåŠ¨æ€å±•ç¤ºã€‚æ¯ä½æˆå‘˜éƒ½æœ‰è‡ªå·±çš„ä¸ªäººä¸»é¡µï¼Œåœ¨ç™»å½•åå¯ä»¥æŸ¥çœ‹ã€‚ä¸ªäººä¸»é¡µåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
	â€¢	åŸºæœ¬ä¿¡æ¯ï¼šæˆå‘˜çš„å§“åã€ç…§ç‰‡å¤´åƒã€è”ç³»æ–¹å¼ç­‰åŸºæœ¬èµ„æ–™ï¼Œæ¥è‡ªæˆå‘˜è¡¨ã€‚æˆå‘˜å¯ä»¥æ›´æ–°è‡ªå·±çš„ä¸ªäººä¿¡æ¯ï¼ˆå¦‚ä¸Šä¼ æ–°å¤´åƒæˆ–ä¿®æ”¹å¤‡æ³¨ï¼‰ã€‚
	â€¢	è´Ÿè´£ç‰©å“å’Œä½ç½®åˆ—è¡¨ï¼šå±•ç¤ºè¯¥æˆå‘˜ç›®å‰è´Ÿè´£çš„æ‰€æœ‰ç‰©å“æ¸…å•å’Œå®éªŒå®¤ä½ç½®æ¸…å•ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæˆå‘˜è´Ÿè´£æŸäº›è¯•å‰‚å’Œè®¾å¤‡ï¼Œåˆ™åœ¨å…¶ä¸»é¡µä¸Šåˆ—å‡ºè¿™äº›ç‰©å“åç§°ï¼ˆå¯é“¾æ¥åˆ°ç‰©å“è¯¦æƒ…ï¼‰ï¼Œä»¥åŠä»–ä½œä¸ºè´Ÿè´£äººæ‰€ç®¡ç†çš„å®éªŒå®¤ä½ç½®ï¼ˆä¾‹å¦‚æŸä¸ªè¯•å‰‚æŸœç”±ä»–è´Ÿè´£ï¼‰ã€‚è¿™æ ·æˆå‘˜å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ä¸è‡ªå·±æœ‰å…³çš„æ‰€æœ‰èµ„äº§ã€‚
	â€¢	é€šçŸ¥æé†’ï¼šå½“ä¸æˆå‘˜ç›¸å…³çš„ç‰©å“æˆ–ä½ç½®ä¿¡æ¯å‘ç”Ÿæ”¹åŠ¨æ—¶ï¼ˆä¾‹å¦‚ä»–è´Ÿè´£çš„ç‰©å“è¢«åˆ«äººç¼–è¾‘äº†ï¼Œæˆ–ä»–è´Ÿè´£çš„å®éªŒå®¤åŒºåŸŸå¢åŠ äº†æ–°ç‰©å“ï¼‰ï¼Œç³»ç»Ÿä¼šç”Ÿæˆä¸€æ¡é€šçŸ¥ã€‚åœ¨ä¸ªäººä¸»é¡µä¸Šï¼Œè¿™äº›é€šçŸ¥ä¼šåˆ—å‡ºæœ€è¿‘çš„åŠ¨æ€ï¼Œä¾‹å¦‚ï¼šâ€œä½ çš„è´Ÿè´£ç‰©å“ Xè¯•å‰‚ ä¿¡æ¯äºæ˜¨æ—¥è¢«æ›´æ–°â€æˆ–â€œä½ ç®¡ç†çš„ è¯•å‰‚æŸœA æ–°å¢äº†ç‰©å“ Yâ€ã€‚è¿™éƒ¨åˆ†åŠŸèƒ½å¯é€šè¿‡ç»´æŠ¤ä¸€å¼ æ´»åŠ¨æ—¥å¿—è¡¨æˆ–é€šçŸ¥è¡¨å®ç°ã€‚åœ¨ç‰©å“æˆ–ä½ç½®æ›´æ–°çš„ä»£ç ä¸­æ£€æŸ¥å…¶è´Ÿè´£äººï¼Œå¦‚æœä¸æ˜¯å½“å‰æ“ä½œäººï¼Œåˆ™ä¸ºè´Ÿè´£äººåˆ›å»ºé€šçŸ¥è®°å½•ã€‚é¡µé¢åŠ è½½æ—¶ï¼Œå†è¿‡æ»¤å‡ºå½“å‰ç”¨æˆ·ç›¸å…³çš„æœªè¯»é€šçŸ¥åˆ—è¡¨è¿›è¡Œæ˜¾ç¤º ï¿¼ ï¿¼ã€‚ç”¨æˆ·æŸ¥çœ‹åå¯å°†é€šçŸ¥æ ‡è®°ä¸ºå·²è¯»ï¼ˆæˆ–ç³»ç»Ÿç®€å•åœ°åœ¨é¡µé¢æ˜¾ç¤ºæœ€è¿‘è‹¥å¹²æ¡å³å¯ï¼‰ã€‚
	â€¢	ä¸ªäººå±•ç¤ºæ¿å’Œç•™è¨€æ¿ï¼šä¸ªäººå±•ç¤ºæ¿å¯ä»¥è®©æˆå‘˜å‘å¸ƒä¸€äº›çŠ¶æ€æˆ–ä»‹ç»ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰ï¼Œä½†é¢˜ç›®ä¸­ç‰¹åˆ«æåˆ°äº†â€œç•™è¨€æ¿â€ï¼Œæ„å‘³ç€å…¶å®ƒæˆå‘˜å¯ä»¥åœ¨æŸäººä¸»é¡µä¸Šç•™ä¸‹ç•™è¨€ã€‚è¿™ç±»ä¼¼äºç®€å•çš„è®¨è®ºåŒºæˆ–è¯„è®ºåŠŸèƒ½ã€‚å®ç°æ—¶å¯ä¸ºæ¯ä¸ªæˆå‘˜è®¾ä¸€ä¸ªç•™è¨€åˆ—è¡¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆä¾‹å¦‚ messages è¡¨ï¼Œå­—æ®µåŒ…æ‹¬ç•™è¨€IDã€å‘é€è€…ã€æ¥æ”¶è€…ã€å†…å®¹ã€æ—¶é—´ï¼‰ã€‚åœ¨æˆå‘˜ä¸»é¡µä¸‹æ–¹å±•ç¤ºæ‰€æœ‰ç»™è¯¥æˆå‘˜çš„ç•™è¨€ï¼Œå¹¶æä¾›ä¸€ä¸ªç•™è¨€è¡¨å•ï¼Œå…è®¸å…¶ä»–ç™»å½•ç”¨æˆ·è¾“å…¥å†…å®¹æäº¤ã€‚åç«¯æ”¶åˆ°ç•™è¨€åæ’å…¥ messages è¡¨ï¼Œå¹¶åˆ·æ–°è¯¥æˆå‘˜ä¸»é¡µæ˜¾ç¤ºã€‚è¿™æ ·ç»„å†…æˆå‘˜å¯ä»¥å½¼æ­¤äº¤æµï¼Œä¾‹å¦‚æé†’è¡¥å……æŸç‰©å“åº“å­˜ç­‰ã€‚
	â€¢	ä¸ªäººæ“ä½œè®°å½•ï¼šæˆå‘˜ä¸»é¡µè¿˜å¯ä»¥åˆ—å‡ºè¯¥ç”¨æˆ·è‡ªèº«çš„æ“ä½œæ—¥å¿—ï¼Œæ¯”å¦‚â€œä½ äº2025-07-20æ·»åŠ äº†ç‰©å“ Xâ€â€œä½ äº2025-07-18ç¼–è¾‘äº†å®éªŒå®¤ä½ç½® Yâ€ç­‰ã€‚è¿™é€šè¿‡æŸ¥è¯¢æ—¥å¿—è¡¨ä¸­è¿‡æ»¤å‡ºuser_idç­‰äºå½“å‰ç”¨æˆ·çš„è®°å½•å®ç°ï¼Œç±»ä¼¼åœ°å¯ä»¥ç”¨ Pandas è¯»å–æ—¥å¿— DataFrame åæŒ‰ç”¨æˆ·ç­›é€‰ã€‚æ­¤åŠŸèƒ½è®©ç”¨æˆ·å›é¡¾è‡ªå·±åœ¨ç³»ç»Ÿä¸­çš„æ´»åŠ¨å†å²ï¼Œæé«˜è´£ä»»è¿½è¸ªæ€§ã€‚

ä»å®ç°è§’åº¦æ¥çœ‹ï¼Œæˆå‘˜ç®¡ç†éœ€è¦å»ºç«‹ç”¨æˆ·è®¤è¯æœºåˆ¶ï¼ˆä¸‹ä¸€èŠ‚è¯¦è¿°ï¼‰ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯æˆ–è¿›è¡Œç™»å½•åæ“ä½œã€‚æˆå‘˜ä¸»é¡µé€šå¸¸å¯¹åº” URL è·¯å¾„å¦‚/member/<username>æˆ–/profileï¼ˆåè€…é€šè¿‡sessionè¯†åˆ«ç”¨æˆ·ï¼‰ã€‚è§†å›¾å‡½æ•°éœ€è¦ä»æ•°æ®åº“æå–è¯¥æˆå‘˜çš„ç›¸å…³ä¿¡æ¯ï¼šMembersè¡¨åŸºæœ¬ä¿¡æ¯ï¼ŒItemsè¡¨ä¸­è´Ÿè´£äººæ˜¯è¯¥æˆå‘˜çš„æ¡ç›®åˆ—è¡¨ï¼ŒLocationsè¡¨ä¸­è´Ÿè´£äººæ˜¯è¯¥æˆå‘˜çš„æ¡ç›®åˆ—è¡¨ï¼ŒLogs/Notificationsè¡¨ä¸­è¿‡å»çš„ç›¸å…³æ´»åŠ¨ï¼ŒMessagesè¡¨ä¸­æ”¶ä»¶äººä¸ºè¯¥æˆå‘˜çš„ç•™è¨€ã€‚å¯ä»¥ä½¿ç”¨å¤šæ¬¡ SQL æŸ¥è¯¢æˆ–ä¸€æ¬¡è”åˆæŸ¥è¯¢è·å–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Pandas åˆ†åˆ«è¯»å–è¡¨å†è¿›è¡Œåˆå¹¶ã€‚å–å‡ºç»“æœåï¼Œå°†å…¶ä¼ ç»™æ¨¡æ¿ï¼Œåœ¨é¡µé¢ä¸Šåšå¾ªç¯æ˜¾ç¤ºåˆ—è¡¨ã€‚åŒæ—¶ï¼Œæä¾›å¿…è¦çš„é“¾æ¥ä»¥è·³è½¬åˆ°å…·ä½“ç‰©å“æˆ–ä½ç½®è¯¦æƒ…ï¼Œæ–¹ä¾¿è¿›ä¸€æ­¥æ“ä½œã€‚

æ¯ä¸ªäººå¯ä»¥æŸ¥çœ‹åˆ«äººå’Œè‡ªå·±çš„ä¸»é¡µï¼Œå¯ä»¥åœ¨ç•™è¨€æ¿ç•™è¨€ï¼ˆpandaså»ºè¡¨è®°å½•ï¼‰ï¼Œå¯ä»¥ç¼–è¾‘è‡ªå·±çš„å±•ç¤ºæ¿ï¼ˆå¯ä»¥ç”¨æ•°æ®è¡¨å•é‡Œçš„å¤‡æ³¨ï¼‰


### å®éªŒå®¤ä½ç½®ç®¡ç†å­ç³»ç»Ÿ

å®éªŒå®¤ä½ç½®ç®¡ç†æ¨¡å—ä»¥ç©ºé—´å¯è§†åŒ–çš„æ–¹å¼å¸®åŠ©ç”¨æˆ·äº†è§£ç‰©å“åˆ†å¸ƒã€‚ç°åœ¨æ¯ä¸ªå®éªŒå®¤ä½ç½®ï¼ˆå¦‚æˆ¿é—´ã€æŸœå­ã€å†°ç®±ç­‰ï¼‰éƒ½æœ‰ä¸€å¼ å…³è”çš„å›¾ç‰‡ï¼ˆæ¯”å¦‚æˆ¿é—´å¸ƒå±€å›¾æˆ–æŸœå†…åˆ†éš”ç¤ºæ„å›¾ï¼Œä¹Ÿå°±æ˜¯ä½ç½®çš„ä¸€ä¸ªè¡¨å±æ€§ï¼Œsqliteé‡Œè®°å½•äº†å›¾ç‰‡è·¯å¾„çš„ï¼‰ï¼Œç³»ç»Ÿå…è®¸å°†è¯¥ä½ç½®æ‰€å«ç‰©å“ç”¨**å¤§å¤´é’ˆï¼ˆå›¾é’‰ï¼‰**çš„æ–¹å¼æ ‡è®°åœ¨å›¾ç‰‡ä¸Šã€‚æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥å‚ä¸å®šä½ï¼šå³å¤§å®¶å¯ä»¥å°†æŸç‰©å“çš„å›¾é’‰æ”¾ç½®åœ¨å®éªŒå®¤ä½ç½®å›¾ç‰‡çš„æ­£ç¡®ä½ç½®ä¸Šï¼Œä»¥ä¾¿ç»„å‘˜ç‚¹å‡»å›¾é’‰å³å¯æŸ¥çœ‹å¯¹åº”ç‰©å“ä¿¡æ¯å’Œè´Ÿè´£äººã€‚

æ¯”å¦‚æˆ‘ä»¬åœ¨â€œå®éªŒå®¤å¸ƒå±€â€å›¾åƒä¸Šæ”¾ç½®äº†ä¸€äº›å¸¦åç§°æ ‡ç­¾çš„å®šä½é’ˆï¼ˆè“è‰²å›¾æ ‡ï¼‰ï¼Œæ ‡è®°å‡ºä¸åŒå­˜å‚¨åŒºçš„ä½ç½®ç¤ºæ„ã€‚å³ä¾§çš„åˆ—è¡¨åˆ—å‡ºäº†è¿™äº›ä½ç½®çš„åç§°ã€‚ç‚¹å‡»å›¾åƒä¸­çš„å›¾é’‰ï¼Œå¯ä»¥å¼¹å‡ºæ˜¾ç¤ºè¯¥ä½ç½®æˆ–ç‰©å“çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ç§æ˜ å°„åŠŸèƒ½çš„å®ç°ï¼Œå°†æŠ½è±¡çš„å­˜å‚¨ä½ç½®å’Œå®ä½“ç©ºé—´å¯¹åº”èµ·æ¥ï¼Œä½¿å®éªŒå®¤æˆå‘˜åœ¨æœç´¢åˆ°æŸç‰©å“åï¼Œå¯ä»¥ç›´è§‚åœ°æ‰¾åˆ°å®ƒåœ¨æˆ¿é—´ä¸­çš„ä½ç½® ï¿¼ã€‚

åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œæ¯å½“ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªå…·ä½“çš„å®éªŒå®¤ä½ç½®é¡µé¢ï¼ˆä¾‹å¦‚â€œè¯•å‰‚æŸœAâ€é¡µé¢ï¼‰ï¼Œåå°ä¼šåŠ è½½è¯¥ä½ç½®çš„å›¾ç‰‡ä»¥åŠå±äºæ­¤ä½ç½®çš„æ‰€æœ‰ç‰©å“åæ ‡ã€‚é¡µé¢å‰ç«¯é€šè¿‡ HTML å’Œ CSS/JavaScript å°†å›¾é’‰æ¸²æŸ“å åŠ åœ¨å›¾ç‰‡ä¸Šã€‚å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1.	åæ ‡æ•°æ®å‡†å¤‡ï¼šç‰©å“è¡¨ä¸­éœ€è¦æœ‰è®°å½•æ¯ä»¶ç‰©å“åœ¨å›¾ç‰‡ä¸Šçš„ç›¸å¯¹åæ ‡ï¼ˆå¦‚pos_x, pos_yç™¾åˆ†æ¯”ï¼‰ã€‚è¿™äº›åæ ‡å¯ä»¥åœ¨ç‰©å“æ·»åŠ /ç¼–è¾‘æ—¶ç”±ç”¨æˆ·æŒ‡å®šï¼Œæˆ–è€…åœ¨ä½ç½®é¡µé¢è¿›å…¥â€œç¼–è¾‘æ¨¡å¼â€æ—¶é€šè¿‡ç‚¹å‡»é€‰å–ã€‚åˆå§‹å¯èƒ½å¾ˆå¤šç‰©å“æœªè®¾ç½®åæ ‡ï¼Œé¡µé¢å¯æä¾›â€œæ·»åŠ æ ‡è®°â€æŒ‰é’®ã€‚

2.	æ˜¾ç¤ºå›¾ç‰‡ä¸å›¾é’‰ï¼šåœ¨æ¨¡æ¿ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå®¹å™¨ <div> æ¥åŒ…è£¹ä½ç½®å›¾ç‰‡ï¼Œå¹¶è®¾ç½® position: relative;ã€‚ç„¶åå¯¹äºæ¯ä¸ªæœ‰åæ ‡çš„ç‰©å“ï¼Œç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„å…ƒç´ ï¼ˆå¦‚<img src="pin_icon.png">æˆ–ä¸€ä¸ªå¸¦å®šä½å›¾æ ‡çš„ <span>ï¼‰æ”¾å…¥è¯¥å®¹å™¨ã€‚é€šè¿‡CSSå°†å…¶leftè®¾ä¸ºpos_x%ï¼Œtopè®¾ä¸ºpos_y%ï¼Œä»è€Œä½¿å›¾é’‰å‡ºç°åœ¨ç›¸å¯¹ä½ç½®ä¸Šã€‚æ¯ä¸ªå›¾é’‰å…ƒç´ å¸¦æœ‰æ¯”å¦‚data-item-idå±æ€§ï¼Œæˆ–è€…åšæˆä¸€ä¸ªé“¾æ¥ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œå¯ä»¥è§¦å‘æ˜¾ç¤ºè¯¥ç‰©å“è¯¦æƒ…çš„å°å¼¹çª—ï¼ˆå¯ç”¨Bootstrapçš„Tooltip/Popoverï¼Œæˆ–ç®€å•å®ç°ä¸€ä¸ªéšè—çš„æ˜¾ç¤ºä¿¡æ¯ï¼‰ã€‚

3.	æ·»åŠ /ç¼–è¾‘æ ‡è®°ï¼šå½“ç”¨æˆ·ç‚¹å‡»â€œæ·»åŠ æ ‡è®°â€åï¼Œé¡µé¢å¯ä»¥å¯ç”¨ä¸€ä¸ªJSäº‹ä»¶ç›‘å¬å›¾ç‰‡çš„ç‚¹å‡»ä½ç½®ã€‚ç”¨æˆ·åœ¨å›¾åƒä¸ŠæŸå¤„å•å‡»ï¼Œæ•è·é¼ æ ‡ç›¸å¯¹äºå›¾ç‰‡å·¦ä¸Šè§’çš„åæ ‡ï¼Œé€šè¿‡å›¾ç‰‡å®½é«˜æ¢ç®—å¾—åˆ°ç™¾åˆ†æ¯”ä½ç½®ã€‚éšåå¯ä»¥å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œåˆ—å‡ºå½“å‰åœ°ç‚¹å°šæœªå®šä½çš„ç‰©å“è®©ç”¨æˆ·é€‰æ‹©ï¼Œæˆ–ç›´æ¥è¾“å…¥ç‰©å“ä¿¡æ¯ä»¥æ–°å»ºã€‚æäº¤åï¼Œåå°pandaså°†åœ¨è¡¨æ ¼ä¸­ä¿å­˜è¯¥ç‰©å“çš„åæ ‡ï¼ˆå¦‚æœæ–°å»ºåˆ™ä¹Ÿæ’å…¥sqliteçš„ç‰©å“è¡¨ï¼‰ã€‚ä¸‹æ¬¡åŠ è½½æ—¶ï¼Œè¯¥ç‰©å“å›¾é’‰å°±ä¼šå‡ºç°åœ¨ç›¸åº”ä½ç½®ã€‚
 ï¿¼ ï¿¼
4.	ç§»åŠ¨æˆ–åˆ é™¤æ ‡è®°ï¼šå¯¹äºå·²æœ‰çš„å›¾é’‰ï¼Œä¹Ÿåº”æä¾›è°ƒæ•´åŠŸèƒ½ã€‚ä¾‹å¦‚æ‹–æ‹½å›¾é’‰åˆ°æ–°ä½ç½®ï¼Œæˆ–åˆ é™¤å›¾é’‰ã€‚å½“æ‹–æ‹½å®Œæˆæ—¶ï¼Œä½¿ç”¨JSè·å–æ–°åæ ‡å¹¶é€šè¿‡ AJAX æäº¤æ›´æ–°ç‰©å“è®°å½•ä¸­çš„åæ ‡å­—æ®µã€‚åˆ é™¤å›¾é’‰å¯ä»¥ç†è§£ä¸ºç‰©å“ä¸å†å­˜æ”¾äºè¯¥ä½ç½®ï¼Œå¯èƒ½éœ€è¦æ›´æ–°ç‰©å“çš„ location_id æˆ–æ ‡è®°å…¶åæ ‡æ— æ•ˆã€‚

5.	ä½ç½®è¯¦æƒ…ï¼šå®éªŒå®¤ä½ç½®é¡µé¢é™¤äº†å›¾ç‰‡å’Œå›¾é’‰ï¼Œè¿˜åº”æ˜¾ç¤ºè¯¥ä½ç½®çš„åŸºæœ¬ä¿¡æ¯ï¼ˆä¾‹å¦‚å¤‡æ³¨ã€è´Ÿè´£äººç­‰ï¼‰ä»¥åŠç‰©å“åˆ—è¡¨ï¼ˆæ‰€æœ‰ location_id æŒ‡å‘æ­¤ä½ç½®çš„ç‰©å“æ¸…å•ï¼‰ã€‚è¿™æ ·ç”¨æˆ·å¯ä»¥åœ¨ä½ç½®é¡µé¢åŒæ—¶çœ‹åˆ°å›¾ç‰‡æ ‡è®°å’Œæ–‡å­—åˆ—è¡¨ï¼Œä¸¤è€…åŒæ­¥ã€‚åˆ—è¡¨ä¸­çš„ç‰©å“è‹¥ç¼ºå°‘åæ ‡æ ‡è®°ï¼Œå¯ä»¥ç”¨ç‰¹æ®Šæ ·å¼æ ‡æ³¨æé†’ç”¨æˆ·å»å®šä½å®ƒã€‚

é€šè¿‡ä¸Šè¿°åŠŸèƒ½ï¼Œå®éªŒå®¤æˆå‘˜èƒ½å¤Ÿæ–¹ä¾¿åœ°å°†åº“æˆ¿ã€æŸœå­çš„å®é™…å¸ƒå±€å’Œç³»ç»Ÿæ•°æ®ç›¸å…³è”ã€‚ä¾‹å¦‚ï¼Œæ–°è¿›äº†ä¸€ç“¶åŒ–å­¦è¯•å‰‚ï¼Œç”¨æˆ·åœ¨ç‰©å“ç®¡ç†ä¸­ç™»è®°åï¼Œå¯ä»¥ç«‹åˆ»åœ¨ç›¸åº”æŸœå­çš„å›¾ç‰‡ä¸Šæ ‡è®°å®ƒçš„ä½ç½®ï¼›å…¶ä»–æˆå‘˜æ—¥åæŸ¥çœ‹æ—¶ï¼Œåªéœ€ç‚¹å‡»æŸœå­å›¾ä¸Šçš„å›¾é’‰å°±èƒ½çŸ¥é“è¯¥è¯•å‰‚æ”¾åœ¨å“ªä¸€å±‚å“ªä¸€æ ¼ ï¿¼ã€‚è¿™ç§ç›´è§‚çš„ç®¡ç†æ–¹å¼æé«˜äº†å®éªŒå®¤ç®¡ç†æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚


### ç”¨æˆ·ç™»å½•ä¸æƒé™

ç”±äºç³»ç»Ÿä¸è®¾ç®¡ç†å‘˜è´¦æˆ·ï¼Œä½†éœ€è¦åŒºåˆ†ä¸åŒæˆå‘˜çš„èº«ä»½ï¼Œå› æ­¤ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ˜¯å¿…è¦çš„ã€‚ç™»å½•ç³»ç»Ÿä¿è¯åªæœ‰è¯¾é¢˜ç»„å†…éƒ¨æˆå‘˜ï¼ˆå·²åœ¨æˆå‘˜è¡¨ä¸­æ³¨å†Œçš„ç”¨æˆ·ï¼‰æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„åŠŸèƒ½é¡µé¢ï¼Œå¹¶æ ¹æ®ç™»å½•èº«ä»½æä¾›ä¸ªæ€§åŒ–å†…å®¹ï¼ˆå¦‚ä¸ªäººä¸»é¡µã€ç¼–è¾‘æƒé™ç­‰ï¼‰ã€‚

å®ç°æ€è·¯ï¼š
	â€¢	ç”¨æˆ·æ³¨å†Œï¼šå¦‚æœé¢„å…ˆåœ¨æ•°æ®åº“ä¸­å»ºç«‹äº†æ‰€æœ‰æˆå‘˜è´¦å·ï¼Œä¹Ÿå¯ä»¥çœç•¥è‡ªåŠ©æ³¨å†ŒåŠŸèƒ½ã€‚å¦‚æœéœ€è¦æ³¨å†Œï¼Œåˆ™æä¾›æ³¨å†Œè¡¨å•ï¼Œæ”¶é›†ç”¨æˆ·åã€å¯†ç ã€é‚®ç®±ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºæ–°æˆå‘˜è®°å½•ã€‚å¯†ç åº”é‡‡ç”¨å®‰å…¨æ•£åˆ—ç®—æ³•ä¿å­˜ï¼ˆå¦‚Werkzeugæä¾›çš„generate_password_hashï¼‰ï¼Œç¡®ä¿ä¸ä¼šæ˜æ–‡å­˜å‚¨å¯†ç ã€‚
	â€¢	ç™»å½•ï¼šæä¾›ç™»å½•é¡µé¢ï¼ˆ/loginï¼‰ï¼Œè®©ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚Flask åç«¯éªŒè¯å¯†ç æ­£ç¡®åï¼Œä½¿ç”¨ Flask çš„ä¼šè¯æœºåˆ¶æˆ– Flask-Login æ‰©å±•å°†ç”¨æˆ·æ ‡è®°ä¸ºå·²ç™»å½•çŠ¶æ€ ï¿¼ã€‚ä¾‹å¦‚ï¼ŒFlask-Login å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç†ç”¨æˆ· sessionï¼Œå®ç°ç™»å½•ã€ç™»å‡ºç­‰ ï¿¼ã€‚ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä¸»ç•Œé¢æˆ–ä¸ªäººä¸»é¡µï¼Œç™»å½•å¤±è´¥åˆ™ç»™å‡ºé”™è¯¯æç¤ºå¹¶å¯é‡è¯•ã€‚
	â€¢	è®¿é—®æ§åˆ¶ï¼šä½¿ç”¨ç™»å½•è£…é¥°å™¨æˆ–åˆ¤æ–­ä¼šè¯çš„æ–¹æ³•ï¼Œä¿æŠ¤éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„è·¯ç”±ã€‚ä¾‹å¦‚ç‰©å“åˆ—è¡¨ã€æˆå‘˜ä¸»é¡µã€ä½ç½®ç®¡ç†ç­‰è·¯ç”±åœ¨æœªç™»å½•æ—¶é‡å®šå‘åˆ°ç™»å½•é¡µã€‚Flask-Login æä¾›äº†@login_requiredè£…é¥°å™¨ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚ç”±äºç³»ç»Ÿä¸­æ‰€æœ‰ç™»å½•ç”¨æˆ·æƒé™åŸºæœ¬ç›¸åŒï¼ˆéƒ½å¯ä»¥å¢æ”¹ç‰©å“ç­‰ï¼‰ï¼Œå› æ­¤ä¸»è¦çš„æƒé™æ§åˆ¶æ˜¯éœ€ç™»å½•ï¼Œè€Œä¸åŒºåˆ†æ›´ç»†çš„è§’è‰²ã€‚æŸäº›æ•æ„Ÿæ“ä½œå¯ä»¥å¢åŠ é¢å¤–æ£€æŸ¥ï¼Œä¾‹å¦‚åªæœ‰è´Ÿè´£äººæ‰æ”¶åˆ°é€šçŸ¥æˆ–å¯ä»¥ä¿®æ”¹è´Ÿè´£å­—æ®µç­‰ï¼Œè¿™åœ¨è§†å›¾é€»è¾‘ä¸­é€šè¿‡å¯¹æ¯”å½“å‰ç”¨æˆ·ä¸è®°å½•è´Ÿè´£äººæ¥å†³å®šã€‚
	â€¢	ç™»å‡ºï¼šæä¾›ç™»å‡ºæŒ‰é’®ï¼Œè°ƒç”¨ Flask-Login çš„ logout_user æˆ–è€…æ‰‹åŠ¨popä¼šè¯ï¼Œä»¥é”€æ¯ç™»å½•çŠ¶æ€ã€‚
	â€¢	å¯†ç å®‰å…¨ï¼šé™¤æ•£åˆ—å­˜å‚¨å¯†ç å¤–ï¼Œå¯ä»¥è€ƒè™‘é˜²æ­¢æš´åŠ›ç ´è§£ï¼ˆä¾‹å¦‚ç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šé”å®šä¸€æ®µæ—¶é—´ï¼‰ï¼Œæˆ–ä½¿ç”¨éªŒè¯ç  ï¿¼ç­‰å¢å¼ºå®‰å…¨æ€§ã€‚ä¸è¿‡åœ¨å°å‹å®éªŒå®¤å†…éƒ¨åº”ç”¨ä¸­ï¼Œæ­¤è¦æ±‚å¯ä»¥é…Œæƒ…é™ä½ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯å°å‹å®éªŒå®¤ï¼Œæ‰€ä»¥ä»£ç ä»ç®€ã€‚


### æ–‡ä»¶ä¸Šä¼ ä¸å›¾ç‰‡é¢„è§ˆ

æ–‡ä»¶ï¼ˆå›¾ç‰‡ï¼‰ä¸Šä¼ æ˜¯æœ¬ç³»ç»Ÿçš„å…³é”®è¾…åŠ©åŠŸèƒ½ï¼Œæ¶‰åŠæˆå‘˜å¤´åƒã€ç‰©å“ç…§ç‰‡ä»¥åŠå®éªŒå®¤ä½ç½®å¹³é¢å›¾ç­‰ä¸Šä¼ ã€‚ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œç³»ç»Ÿéœ€è¦å®ç°ç›´æ¥æ‹ç…§ä¸Šä¼ å’Œå³æ—¶é¢„è§ˆã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨ç›¸å…³çš„è¡¨å•é¡µé¢ï¼ˆå¦‚æ–°å¢/ç¼–è¾‘ç‰©å“ï¼Œç¼–è¾‘æˆå‘˜ä¿¡æ¯ï¼Œæ–°å¢/ç¼–è¾‘ä½ç½®ï¼‰ä¸­ï¼Œå›¾ç‰‡å­—æ®µåº”å…è®¸ç”¨æˆ·è°ƒå–æ‘„åƒå¤´æ‹ç…§æˆ–ä»æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©å›¾ç‰‡ï¼Œå¹¶åœ¨æäº¤å‰äºé¡µé¢ä¸Šé¢„è§ˆç¼©ç•¥å›¾æ•ˆæœã€‚

å‰ç«¯å®ç°ï¼š åˆ©ç”¨ HTML5 æ–‡ä»¶è¾“å…¥å…ƒç´ å®ç°ã€‚
å…¶ä¸­accept="image/*"é™å®šåªèƒ½é€‰æ‹©å›¾åƒæ–‡ä»¶ï¼Œcapture="environment"æç¤ºåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè°ƒç”¨åæ‘„åƒå¤´ç›´æ¥æ‹ç…§ ï¿¼ï¼ˆå¦‚åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­ä¼šç›´æ¥æ‰“å¼€ç›¸æœºï¼‰ã€‚ç„¶åï¼Œé€šè¿‡å°‘é‡ JavaScript å®ç°é€‰æ‹©æ–‡ä»¶åçš„é¢„è§ˆï¼šç›‘å¬ <input type="file"> çš„å˜åŒ–äº‹ä»¶ï¼Œè¯»å–æ‰€é€‰æ–‡ä»¶ç”Ÿæˆæœ¬åœ° URL æˆ– DataURLï¼Œåœ¨æ ‡ç­¾ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œå¹¶å–æ¶ˆéšè—å®ƒã€‚è¿™ä½¿å¾—ç”¨æˆ·åœ¨æäº¤å‰å°±èƒ½çœ‹åˆ°æ‹æ‘„æˆ–é€‰å–çš„ç…§ç‰‡ç¼©ç•¥å›¾ï¼Œç¡®è®¤æ— è¯¯ã€‚

åç«¯å®ç°ï¼š Flask å¤„ç†æ–‡ä»¶ä¸Šä¼ éœ€è¦åœ¨ <form> æ ‡ç­¾ä¸ŠæŒ‡å®š enctype="multipart/form-data"ï¼Œå¹¶ä½¿ç”¨ request.files æ¥è·å–æ–‡ä»¶å¯¹è±¡ ï¿¼ã€‚
ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†æ–‡ä»¶å­˜åœ¨ä¸”æ–‡ä»¶åéç©ºï¼Œç„¶åç”¨ secure_filename æ¸…ç†æ–‡ä»¶åå¹¶ä¿å­˜åˆ°æŒ‡å®šUPLOAD_FOLDERç›®å½• ï¿¼ ï¿¼ã€‚ä¿å­˜æˆåŠŸåï¼ŒæŠŠæ–‡ä»¶åï¼ˆæˆ–ç›¸å¯¹è·¯å¾„ï¼‰å­˜å…¥æ•°æ®åº“ä¸­ç‰©å“è¡¨çš„å›¾ç‰‡å­—æ®µã€‚è¿™æ ·ï¼Œåœ¨æ—¥åæ˜¾ç¤ºæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¾‹å¦‚<img src="{{ url_for('static', filename='images/'+item.image_path) }}">æ¥åŠ è½½è¯¥å›¾ç‰‡ã€‚

ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨å­˜å‚¨è¢«ä¸å¿…è¦åœ°å ç”¨ï¼Œå¯ä»¥å¯¹ä¸Šä¼ å›¾ç‰‡ä½œä¸€äº›å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨ Pillow åº“è°ƒæ•´å›¾åƒå¤§å°æˆ–å‹ç¼©è´¨é‡ï¼Œæˆ–è€…å®šæœŸæ¸…ç†é•¿æ—¶é—´æœªä½¿ç”¨çš„å›¾ç‰‡ã€‚ä½†è¿™äº›å±äºä¼˜åŒ–èŒƒå›´ã€‚åŸºæœ¬å®ç°ä¸Šï¼Œå¦‚Flaskå®˜æ–¹æ–‡æ¡£æ‰€ç¤ºï¼Œåªéœ€å‡ è¡Œä»£ç å³å¯å¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¿å­˜ ï¿¼ ï¿¼ã€‚

æ³¨æ„äº‹é¡¹ï¼š
	â€¢	é¢„è§ˆå®‰å…¨ï¼šç”±äºç›´æ¥åœ¨æµè§ˆå™¨æ˜¾ç¤ºæœ¬åœ°é€‰æ‹©çš„å›¾ç‰‡ä¸æ¶‰åŠæœåŠ¡å™¨äº¤äº’ï¼Œå®‰å…¨é£é™©è¾ƒä½ã€‚ä½†ä¸Šä¼ ååº”å½“åœ¨æœåŠ¡å™¨ç«¯éªŒè¯æ–‡ä»¶ç±»å‹æ˜¯å¦çœŸçš„æ˜¯å›¾åƒï¼ˆä¾‹å¦‚é€šè¿‡è¯»å–æ–‡ä»¶å¤´æˆ–ä½¿ç”¨Imagingåº“ï¼‰ï¼Œå¹¶é™åˆ¶æ–‡ä»¶å¤§å°ï¼Œé˜²æ­¢æ¶æ„ç”¨æˆ·ä¸Šä¼ ç‰¹æ´›ä¼Šæœ¨é©¬æˆ–è¶…å¤§æ–‡ä»¶ ï¿¼ã€‚å¯åœ¨ Flask é…ç½®MAX_CONTENT_LENGTHé™åˆ¶ä¸Šä¼ å¤§å°ï¼Œå¦‚16MBç­‰ ï¿¼ã€‚
	â€¢	å­˜å‚¨è·¯å¾„ï¼šå¦‚å‰æ‰€è¿°ï¼Œæ‰€æœ‰ä¸Šä¼ çš„å›¾ç‰‡éƒ½ä¿å­˜åœ¨ Flask çš„ static ç›®å½•ä¸‹çš„æŸç»Ÿä¸€å­ç›®å½•ä¸­ï¼Œä¾‹å¦‚static/images/ã€‚è¿™ç¡®ä¿ Flask å¯ä»¥ç›´æ¥æœåŠ¡å™¨ç«¯æä¾›è¿™äº›æ–‡ä»¶ ï¿¼ ï¿¼ã€‚æ•°æ®åº“ä»…å­˜ç›¸å¯¹è·¯å¾„æˆ–æ–‡ä»¶åï¼Œé¿å…å­˜å‚¨ç»å¯¹è·¯å¾„å¸¦æ¥çš„è¿ç§»é—®é¢˜ã€‚
	â€¢	å¤šå›¾ç®¡ç†ï¼šå¯¹æŸäº›å®ä½“ï¼Œå¦‚æœéœ€è¦ä¸Šä¼ å¤šå¼ ç›¸å…³å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥æ‰©å±•ä¸ºå•ç‹¬çš„å›¾ç‰‡è¡¨æˆ–åœ¨æ–‡ä»¶åä¸­åŠ å…¥è®°å½•IDåŒºåˆ†ï¼Œä½†æœ¬ç³»ç»Ÿéœ€æ±‚ä¸­æ¯ä¸ªç‰©å“/ä½ç½®/æˆå‘˜åªæœ‰ä¸€å¼ ä¸»è¦å›¾ç‰‡ï¼Œæ•…ä¸éœ€å¤æ‚è®¾è®¡ã€‚

### å‰ç«¯ç•Œé¢ä¸éƒ¨ç½²

ä¸ºäº†è®©ä¸‰ä¸ªå­ç³»ç»Ÿæœ‰ä¸€è‡´ã€å‹å¥½çš„ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç°æœ‰çš„å‰ç«¯ UI æ¡†æ¶ä¾‹å¦‚ Bootstrapã€Semantic UI æˆ– Material Designã€‚è¿™äº›æ¡†æ¶æä¾›äº†ç»Ÿä¸€é£æ ¼çš„å¯¼èˆªæ ã€è¡¨å•æ§ä»¶ã€æŒ‰é’®å’Œå¸ƒå±€æ …æ ¼ç³»ç»Ÿï¼Œå¯ä»¥å¤§å¤§æå‡ç•Œé¢ç¾è§‚åº¦å’Œå¼€å‘æ•ˆç‡ã€‚å…·ä½“è®¾è®¡ä¸Šï¼š
	â€¢	å¯¼èˆªå¸ƒå±€ï¼šåº”ç”¨æœ‰å…¨å±€å¯¼èˆªæ ï¼ŒåŒ…å«é¡µé¢è·³è½¬é“¾æ¥ï¼Œä¾‹å¦‚â€œç‰©å“ç®¡ç†â€ã€â€œå®éªŒå®¤åœ°å›¾â€ã€â€œæˆå‘˜åˆ—è¡¨/ä¸ªäººä¸»é¡µâ€ç­‰ã€‚ç™»å½•åçš„ç”¨æˆ·å¯¼èˆªæ è¿˜å¯æ˜¾ç¤ºå…¶ç”¨æˆ·ååŠç™»å‡ºæŒ‰é’®ã€‚å¯ä»¥åˆ©ç”¨ Flask æ¨¡æ¿ç»§æ‰¿æœºåˆ¶åˆ›å»ºä¸€ä¸ªbase.htmlï¼Œå®šä¹‰å¯¼èˆªå’Œå…¬å…±æ ·å¼ï¼Œå„é¡µé¢æ¨¡æ¿å†ç»§æ‰¿ baseã€‚
	â€¢	åˆ—è¡¨ä¸è¡¨å•ï¼šç‰©å“åˆ—è¡¨é¡µã€æˆå‘˜åˆ—è¡¨é¡µé‡‡ç”¨è¡¨æ ¼æˆ–è€…å¡ç‰‡åˆ—è¡¨æ˜¾ç¤ºè®°å½•ã€‚Bootstrap çš„è¡¨æ ¼æ ·å¼å¯ä»¥æä¾›åŸºæœ¬çš„æ¡çº¹è¡Œã€é«˜äº®æ‚¬åœç­‰æ•ˆæœã€‚è¡¨å•é¡µé¢åˆ™ä½¿ç”¨è¡¨å•ç»„(<div class="form-group">ç­‰)æ¥æ’åˆ—è¾“å…¥å­—æ®µå’Œæ ‡ç­¾ï¼Œé…åˆç®€æ´çš„ CSS æç¤ºã€‚ä½¿ç”¨è¿™äº›ç°æˆç»„ä»¶æœ‰åŠ©äºä¿æŒå„æ¨¡å—ç•Œé¢çš„ä¸€è‡´æ€§ã€‚
	â€¢	å“åº”å¼ï¼šç”±äºå¯èƒ½æˆå‘˜ä¼šç”¨æ‰‹æœºç›´æ¥æ‹ç…§ä¸Šä¼ ï¼Œç•Œé¢éœ€è¦åœ¨ç§»åŠ¨ç«¯æœ‰æ•ˆè¿ä½œã€‚Bootstrap ç­‰æ¡†æ¶å¤©ç”Ÿå…·æœ‰å“åº”å¼æ”¯æŒï¼Œä½¿å¸ƒå±€èƒ½é€‚åº”ä¸åŒå±å¹•ã€‚å°¤å…¶æ˜¯å®éªŒå®¤ä½ç½®çš„å›¾ç‰‡æ ‡è®°é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šå›¾ç‰‡å®¹å™¨å®½åº¦ä¸º100%çˆ¶å…ƒç´ ï¼Œè¿™æ ·åœ¨å°å±å¹•ä¸Šå›¾ç‰‡ä¼šè‡ªåŠ¨ç¼©æ”¾ï¼Œå›¾é’‰çš„ä½ç½®æˆ‘ä»¬ç”¨ç™¾åˆ†æ¯”ä¹Ÿèƒ½éšä¹‹ç¼©æ”¾æ­£ç¡® ï¿¼ã€‚
	â€¢	äº¤äº’å¢å¼ºï¼šå¯ä»¥ä½¿ç”¨å°‘é‡ JavaScript/jQueryæ¥å¢å¼ºç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚ï¼Œç‰©å“åˆ—è¡¨é¡µå¯ä»¥å¼•å…¥ DataTables æ’ä»¶ï¼Œå®ç°å®¢æˆ·ç«¯åˆ†é¡µã€å³æ—¶æœç´¢å’Œæ’åºï¼›ç‰©å“è¯¦æƒ…æˆ–ä½ç½®å›¾é’‰ç‚¹å‡»å¯ä»¥ç”¨æ¨¡æ€æ¡†å¼¹å‡ºè¯¦ç»†ä¿¡æ¯ï¼›ç•™è¨€æ¿çš„æäº¤å¯ä»¥ç”¨ AJAX åˆ·æ–°å±€éƒ¨åŒºåŸŸç­‰ç­‰ã€‚è¿™äº›ä¸æ˜¯å¿…é¡»åŠŸèƒ½ï¼Œä½†å¯ä»¥ä½œä¸ºæ”¹è¿›æ–¹å‘ã€‚

éƒ¨ç½²è¿è¡Œï¼š å¼€å‘å®Œæˆåï¼Œè¯¥ Flask åº”ç”¨å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯ç‹¬ç«‹è¿è¡Œçš„æœåŠ¡éƒ¨ç½²ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œç›´æ¥è¿è¡Œ app.py (å…¶ä¸­åŒ…å«app.run())å³å¯åœ¨æœ¬åœ°å¯åŠ¨æµ‹è¯•æœåŠ¡ ï¿¼ã€‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå¯ä»¥é€‰æ‹©å°† Flask åº”ç”¨é€šè¿‡ WSGI éƒ¨ç½²ï¼Œä¾‹å¦‚ä½¿ç”¨ Gunicorn æˆ– uWSGI é…åˆ Nginx ç­‰ã€‚ç”±äºæœ¬é¡¹ç›®ä½¿ç”¨ SQLiteï¼Œæœ¬åœ°æ–‡ä»¶å³å¯æŒä¹…åŒ–æ•°æ®ï¼Œæ— éœ€é¢å¤–çš„æ•°æ®åº“æœåŠ¡ï¼Œéå¸¸é€‚åˆå°å‹å›¢é˜Ÿå†…ç½‘éƒ¨ç½²ã€‚åªéœ€ç¡®ä¿é™æ€æ–‡ä»¶å¤¹æœ‰è¯»æƒé™ã€ä¸Šä¼ æ–‡ä»¶å¤¹æœ‰å†™æƒé™ï¼Œä»¥åŠè®¾ç½®ä¸€ä¸ªå®‰å…¨çš„ SECRET_KEY ç”¨äºä¼šè¯ç®¡ç†ã€‚

åœ¨å¯åŠ¨æœåŠ¡åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ç›¸åº” IP å’Œç«¯å£ï¼ˆé»˜è®¤127.0.0.1:5000ï¼‰çœ‹åˆ°ç™»å½•ç•Œé¢å¹¶ä½¿ç”¨ç³»ç»Ÿ ï¿¼ã€‚è‹¥å°†å…¶éƒ¨ç½²åœ¨å®éªŒå®¤å±€åŸŸç½‘ä¸Šçš„æœåŠ¡å™¨ï¼Œæ‰€æœ‰ç»„å†…æˆå‘˜ä¾¿å¯å…±åŒè®¿é—®è¿™å¥—ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ååŒç®¡ç†å®éªŒå®¤çš„ç›®çš„ã€‚

æ€»ç»“ï¼š è¿™å¥— Flask åŒ–å­¦å®éªŒå®¤ç®¡ç†ç³»ç»Ÿä»¥ SQLite+Pandas ä¸ºæ•°æ®æ”¯æ’‘ï¼Œæä¾›äº†ç‰©å“ã€äººå‘˜ã€ä½ç½®ä¸‰ä¸ªç»´åº¦çš„ç®¡ç†åŠŸèƒ½ï¼Œå¹¶é€šè¿‡å›¾ç‰‡å’Œå›¾é’‰å°†ç‰©å“ä¸å®é™…ä½ç½®å…³è” ï¿¼ã€‚ç³»ç»Ÿå®ç°è¿‡ç¨‹ä¸­ï¼Œæ³¨é‡äº†ç”¨æˆ·ä½“éªŒï¼ˆå¦‚æ‘„åƒå¤´ä¸Šä¼ ã€å›¾ç‰‡é¢„è§ˆã€é€šçŸ¥æé†’ï¼‰ä»¥åŠä»£ç çš„æ¸…æ™°ç»„ç»‡ï¼ˆä½¿ç”¨è“å›¾åˆ’åˆ†æ¨¡å—ï¼Œæ¨¡æ¿ç»§æ‰¿é‡ç”¨å¸ƒå±€ç­‰ï¼‰ã€‚æŒ‰ç…§ä¸Šè¿°è®¾è®¡å®Œæˆå¼€å‘å’Œè°ƒè¯•åï¼Œå³å¯éƒ¨ç½²ä¸ºä¸€ä¸ªå®Œæ•´å¯è¿è¡Œçš„åº”ç”¨ï¼Œå¸®åŠ©è¯¾é¢˜ç»„æœ‰æ•ˆåœ°ç®¡ç†å®éªŒå®¤èµ„æºå’Œä¿¡æ¯ã€‚é€šè¿‡è¿™ä¸ªå¹³å°ï¼Œåº“å­˜æ¸…å•ã€äººå‘˜åˆ†å·¥ã€ç‰©å“ä½ç½®éƒ½ä¸€ç›®äº†ç„¶ï¼Œå¤§å¤§æé«˜äº†å®éªŒå®¤ç®¡ç†çš„æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚æ¯ä¸ªç”¨æˆ·ä¹Ÿèƒ½é€šè¿‡ç³»ç»Ÿæ–¹ä¾¿åœ°è·å–ä¸è‡ªå·±ç›¸å…³çš„æœ€æ–°åŠ¨æ€ï¼Œå®ç°ä¿¡æ¯çš„åŠæ—¶æ²Ÿé€šä¸å…±äº«ã€‚ ï¿¼ ï¿¼


æ‰€æœ‰çš„å†…å®¹å®Œæ•´åŒ…æ‹¬ï¼Œè¾“å‡ºæ–¹å¼æŒ‰ç…§æœ€ä½³æ–¹å¼æ¥ï¼Œä¿è¯æˆ‘æ¯æ¬¡éƒ½å¯ä»¥é¡ºåˆ©è¿è¡Œï¼è¿è¡Œç¯å¢ƒæ˜¯macmini m4ï¼Œç‰ˆæœ¬éƒ½ç”¨æœ€æ–°çš„ï¼














# aiä»£ç 
åŒ–å­¦å®éªŒå®¤ç®¡ç†ç³»ç»Ÿ â€“ å®Œæ•´ä»£ç 

è¿è¡Œç¯å¢ƒä¾èµ–:
	â€¢	Python 3.x (å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚ 3.10+)
	â€¢	Flask (æœ€æ–°ç‰ˆæœ¬)
	â€¢	Flask-Login (æœ€æ–°ç‰ˆæœ¬)
	â€¢	Flask-SQLAlchemy (æœ€æ–°ç‰ˆæœ¬)
	â€¢	Pandas (ç”¨äºæ•°æ®å¯¼å‡º)

æ³¨: è¯·ç¡®ä¿å®‰è£…ä¸Šè¿°ä¾èµ–åº“ (pip install flask flask-login flask-sqlalchemy pandas) å¹¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º static/images æ–‡ä»¶å¤¹ç”¨äºä¿å­˜ä¸Šä¼ çš„å›¾ç‰‡ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„ä»£ç æ–‡ä»¶åˆ—è¡¨ï¼Œè¯·æŒ‰ç…§å¯¹åº”æ–‡ä»¶åå’Œè·¯å¾„ä¿å­˜ã€‚åœ¨ç»ˆç«¯è¿›å…¥é¡¹ç›®ç›®å½•åï¼Œè¿è¡Œ python app.py å¯åŠ¨ Flask åº”ç”¨ã€‚

# app.py (Flask åç«¯ä»£ç )

import os
from datetime import datetime
from flask import Flask, render_template, request, redirect, url_for, flash, send_file
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager, UserMixin, login_user, logout_user, login_required, current_user
from werkzeug.security import generate_password_hash, check_password_hash
from werkzeug.utils import secure_filename

app = Flask(__name__)
app.config['SECRET_KEY'] = 'supersecretkey'  # ä¸ºå®‰å…¨èµ·è§ï¼Œéƒ¨ç½²æ—¶è¯·ä½¿ç”¨æ›´å¤æ‚çš„éšæœºå€¼
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///lab.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.config['UPLOAD_FOLDER'] = os.path.join('static', 'images')
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # é™åˆ¶ä¸Šä¼ 16MBä»¥å†…çš„æ–‡ä»¶

db = SQLAlchemy(app)
login_manager = LoginManager(app)
login_manager.login_view = 'login'

# å…è®¸ä¸Šä¼ çš„å›¾ç‰‡æ‰©å±•å
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}
def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

# æ•°æ®æ¨¡å‹å®šä¹‰
class Member(UserMixin, db.Model):
    __tablename__ = 'members'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)            # å§“å
    username = db.Column(db.String(100), unique=True, nullable=False)  # ç™»å½•ç”¨æˆ·å
    password_hash = db.Column(db.String(200), nullable=False)    # å¯†ç å“ˆå¸Œ
    contact = db.Column(db.String(100))                          # è”ç³»æ–¹å¼ï¼ˆé‚®ç®±/ç”µè¯ï¼‰
    photo = db.Column(db.String(200))                            # å¤´åƒå›¾ç‰‡è·¯å¾„
    notes = db.Column(db.Text)                                   # å¤‡æ³¨/ä¸ªäººå±•ç¤ºæ¿
    last_modified = db.Column(db.DateTime, default=datetime.utcnow)  # æœ€åä¿®æ”¹æ—¶é—´
    # å…³ç³»ï¼šæˆå‘˜è´Ÿè´£çš„ç‰©å“å’Œä½ç½®ï¼Œä»¥åŠå‘é€/æ”¶åˆ°çš„æ¶ˆæ¯å’Œæ—¥å¿—
    items = db.relationship('Item', backref='responsible_member', lazy=True, foreign_keys='Item.responsible_id')
    locations = db.relationship('Location', backref='responsible_member', lazy=True, foreign_keys='Location.responsible_id')
    sent_messages = db.relationship('Message', backref='sender', lazy=True, foreign_keys='Message.sender_id')
    received_messages = db.relationship('Message', backref='receiver', lazy=True, foreign_keys='Message.receiver_id')
    logs = db.relationship('Log', backref='user', lazy=True)

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)
    def __repr__(self):
        return f'<Member {self.username}>'

class Item(db.Model):
    __tablename__ = 'items'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)    # ç‰©å“åç§°
    category = db.Column(db.String(50))                 # ç±»åˆ«/å±é™©çº§åˆ«
    status = db.Column(db.String(50))                   # å½“å‰çŠ¶æ€ï¼ˆåº“å­˜/å±é™©ç­‰ï¼‰
    responsible_id = db.Column(db.Integer, db.ForeignKey('members.id'))  # è´Ÿè´£äººï¼ˆæˆå‘˜IDï¼‰
    location_id = db.Column(db.Integer, db.ForeignKey('locations.id'))   # å­˜æ”¾ä½ç½®ï¼ˆä½ç½®IDï¼‰
    image = db.Column(db.String(200))                   # å›¾ç‰‡æ–‡ä»¶å
    notes = db.Column(db.Text)                          # å¤‡æ³¨è¯´æ˜
    last_modified = db.Column(db.DateTime, default=datetime.utcnow)  # æœ€åä¿®æ”¹æ—¶é—´
    purchase_link = db.Column(db.String(200))           # è´­ä¹°é“¾æ¥
    pos_x = db.Column(db.Float)                         # åœ¨ä½ç½®å›¾ç‰‡ä¸Šçš„æ ‡è®°Xåæ ‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
    pos_y = db.Column(db.Float)                         # åœ¨ä½ç½®å›¾ç‰‡ä¸Šçš„æ ‡è®°Yåæ ‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
    logs = db.relationship('Log', backref='item', lazy=True)  # æ“ä½œæ—¥å¿—

    def __repr__(self):
        return f'<Item {self.name}>'

class Location(db.Model):
    __tablename__ = 'locations'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)    # ä½ç½®åç§°
    responsible_id = db.Column(db.Integer, db.ForeignKey('members.id'))  # è´Ÿè´£äººï¼ˆæˆå‘˜IDï¼‰
    image = db.Column(db.String(200))                   # ä½ç½®å›¾ç‰‡æ–‡ä»¶å
    notes = db.Column(db.Text)                          # å¤‡æ³¨
    last_modified = db.Column(db.DateTime, default=datetime.utcnow)  # æœ€åä¿®æ”¹æ—¶é—´
    items = db.relationship('Item', backref='location', lazy=True, foreign_keys='Item.location_id')
    logs = db.relationship('Log', backref='location', lazy=True)     # æ“ä½œæ—¥å¿—

    def __repr__(self):
        return f'<Location {self.name}>'

class Log(db.Model):
    __tablename__ = 'logs'
    id = db.Column(db.Integer, primary_key=True)
    timestamp = db.Column(db.DateTime, default=datetime.utcnow)
    user_id = db.Column(db.Integer, db.ForeignKey('members.id'))     # æ‰§è¡Œæ“ä½œçš„ç”¨æˆ·ID
    item_id = db.Column(db.Integer, db.ForeignKey('items.id'), nullable=True)         # æ¶‰åŠçš„ç‰©å“IDï¼ˆå¦‚æœæœ‰ï¼‰
    location_id = db.Column(db.Integer, db.ForeignKey('locations.id'), nullable=True) # æ¶‰åŠçš„ä½ç½®IDï¼ˆå¦‚æœæœ‰ï¼‰
    action_type = db.Column(db.String(50))       # æ“ä½œç±»å‹æè¿°ï¼ˆå¦‚ æ–°å¢ç‰©å“/ä¿®æ”¹ä½ç½® ç­‰ï¼‰
    details = db.Column(db.Text)                 # è¯¦æƒ…å¤‡æ³¨
    def __repr__(self):
        return f'<Log {self.action_type} by {self.user_id}>'

class Message(db.Model):
    __tablename__ = 'messages'
    id = db.Column(db.Integer, primary_key=True)
    sender_id = db.Column(db.Integer, db.ForeignKey('members.id'))    # å‘é€è€…ç”¨æˆ·ID
    receiver_id = db.Column(db.Integer, db.ForeignKey('members.id'))  # æ¥æ”¶è€…ç”¨æˆ·ID
    content = db.Column(db.Text, nullable=False)     # ç•™è¨€å†…å®¹
    timestamp = db.Column(db.DateTime, default=datetime.utcnow)  # ç•™è¨€æ—¶é—´
    def __repr__(self):
        return f'<Message from {self.sender_id} to {self.receiver_id}>'

# åˆå§‹åŒ–æ•°æ®åº“å¹¶åˆ›å»ºé»˜è®¤ç”¨æˆ·
with app.app_context():
    db.create_all()
    if Member.query.count() == 0:
        default_user = Member(name="Admin User", username="admin", contact="admin@example.com", notes="Default admin user")
        default_user.set_password("admin")
        db.session.add(default_user)
        db.session.commit()

@login_manager.user_loader
def load_user(user_id):
    return Member.query.get(int(user_id))

# è·¯ç”±å®šä¹‰
@app.route('/')
def index():
    # æœªç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µï¼Œå·²ç™»å½•åˆ™è¿›å…¥ä¸ªäººä¸»é¡µ
    if current_user.is_authenticated:
        return redirect(url_for('profile', member_id=current_user.id))
    else:
        return redirect(url_for('login'))

@app.route('/login', methods=['GET', 'POST'])
def login():
    if current_user.is_authenticated:
        return redirect(url_for('index'))
    if request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        user = Member.query.filter_by(username=username).first()
        if user and user.check_password(password):
            login_user(user)
            return redirect(url_for('index'))
        else:
            flash('ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®', 'danger')
    return render_template('login.html')

@app.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('login'))

@app.route('/register', methods=['GET', 'POST'])
def register():
    if current_user.is_authenticated:
        return redirect(url_for('index'))
    if request.method == 'POST':
        name = request.form.get('name')
        username = request.form.get('username')
        password = request.form.get('password')
        contact = request.form.get('contact')
        # æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        if Member.query.filter_by(username=username).first():
            flash('ç”¨æˆ·åå·²å­˜åœ¨', 'warning')
        else:
            new_user = Member(name=name, username=username, contact=contact)
            new_user.set_password(password)
            db.session.add(new_user)
            db.session.commit()
            flash('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•', 'success')
            return redirect(url_for('login'))
    return render_template('register.html')

@app.route('/items')
@login_required
def items():
    # ç‰©å“åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰åç§°/å¤‡æ³¨æœç´¢ï¼ŒæŒ‰ç±»åˆ«ç­›é€‰
    search = request.args.get('search', '')
    category_filter = request.args.get('category', '')
    items_query = Item.query
    if search:
        items_query = items_query.filter(Item.name.contains(search) | Item.notes.contains(search))
    if category_filter:
        items_query = items_query.filter_by(category=category_filter)
    items_list = items_query.order_by(Item.name).all()
    # è·å–ç°æœ‰ç±»åˆ«åˆ—è¡¨ä¾›ç­›é€‰é€‰é¡¹
    categories = [c for (c,) in db.session.query(Item.category).distinct() if c]
    return render_template('items.html', items=items_list, search=search, category=category_filter, categories=categories)

@app.route('/items/<int:item_id>')
@login_required
def item_detail(item_id):
    # æŸ¥çœ‹ç‰©å“è¯¦æƒ…
    item = Item.query.get_or_404(item_id)
    return render_template('item_detail.html', item=item)

@app.route('/items/add', methods=['GET', 'POST'])
@login_required
def add_item():
    if request.method == 'POST':
        # è·å–è¡¨å•æ•°æ®å¹¶åˆ›å»ºæ–°ç‰©å“
        name = request.form.get('name')
        category = request.form.get('category')
        status = request.form.get('status')
        responsible_id = request.form.get('responsible_id')
        location_id = request.form.get('location_id')
        notes = request.form.get('notes')
        purchase_link = request.form.get('purchase_link')
        image_file = request.files.get('image')
        image_filename = None
        if image_file and image_file.filename != '' and allowed_file(image_file.filename):
            # ä¿å­˜ä¸Šä¼ çš„ç‰©å“å›¾ç‰‡æ–‡ä»¶
            os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
            filename = secure_filename(image_file.filename)
            filename = datetime.now().strftime("%Y%m%d%H%M%S_") + filename
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            image_file.save(image_path)
            image_filename = filename
        new_item = Item(
            name=name, category=category, status=status,
            responsible_id=responsible_id if responsible_id else None,
            location_id=location_id if location_id else None,
            notes=notes, purchase_link=purchase_link, image=image_filename
        )
        db.session.add(new_item)
        db.session.commit()
        # è®°å½•æ—¥å¿—
        log = Log(user_id=current_user.id, item_id=new_item.id, action_type="æ–°å¢ç‰©å“", details=f"Added item {new_item.name}")
        db.session.add(log)
        db.session.commit()
        flash('ç‰©å“å·²æ·»åŠ ', 'success')
        return redirect(url_for('items'))
    # GET è¯·æ±‚æ—¶ï¼Œè¿”å›ç‰©å“æ·»åŠ è¡¨å•
    members = Member.query.all()
    locations = Location.query.all()
    return render_template('item_form.html', members=members, locations=locations, item=None)

@app.route('/items/<int:item_id>/edit', methods=['GET', 'POST'])
@login_required
def edit_item(item_id):
    item = Item.query.get_or_404(item_id)
    if request.method == 'POST':
        # æ›´æ–°ç‰©å“ä¿¡æ¯
        item.name = request.form.get('name')
        item.category = request.form.get('category')
        item.status = request.form.get('status')
        item.responsible_id = request.form.get('responsible_id')
        item.location_id = request.form.get('location_id')
        item.notes = request.form.get('notes')
        item.purchase_link = request.form.get('purchase_link')
        # å¤„ç†å›¾ç‰‡æ›´æ–°ï¼ˆå¦‚æœæœ‰æ–°ä¸Šä¼ ï¼‰
        image_file = request.files.get('image')
        if image_file and image_file.filename != '' and allowed_file(image_file.filename):
            os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
            filename = secure_filename(image_file.filename)
            filename = datetime.now().strftime("%Y%m%d%H%M%S_") + filename
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            image_file.save(image_path)
            # å¯é€‰ï¼šåˆ é™¤æ—§å›¾ç‰‡æ–‡ä»¶ä»¥èŠ‚çœç©ºé—´ï¼ˆæ­¤å¤„æš‚ä¸åˆ é™¤ï¼‰
            item.image = filename
        item.last_modified = datetime.utcnow()
        db.session.commit()
        # è®°å½•æ—¥å¿—
        log = Log(user_id=current_user.id, item_id=item.id, action_type="ä¿®æ”¹ç‰©å“", details=f"Edited item {item.name}")
        db.session.add(log)
        db.session.commit()
        flash('ç‰©å“ä¿¡æ¯å·²æ›´æ–°', 'success')
        return redirect(url_for('items'))
    members = Member.query.all()
    locations = Location.query.all()
    return render_template('item_form.html', members=members, locations=locations, item=item)

@app.route('/items/<int:item_id>/delete', methods=['POST'])
@login_required
def delete_item(item_id):
    item = Item.query.get_or_404(item_id)
    db.session.delete(item)
    db.session.commit()
    # è®°å½•æ—¥å¿—
    log = Log(user_id=current_user.id, item_id=item_id, action_type="åˆ é™¤ç‰©å“", details=f"Deleted item {item.name}")
    db.session.add(log)
    db.session.commit()
    flash('ç‰©å“å·²åˆ é™¤', 'info')
    return redirect(url_for('items'))

@app.route('/locations')
@login_required
def locations_list():
    locations = Location.query.order_by(Location.name).all()
    return render_template('locations.html', locations=locations)

@app.route('/locations/add', methods=['GET', 'POST'])
@login_required
def add_location():
    if request.method == 'POST':
        # è·å–å¹¶ä¿å­˜æ–°çš„ä½ç½®è®°å½•
        name = request.form.get('name')
        responsible_id = request.form.get('responsible_id')
        notes = request.form.get('notes')
        image_file = request.files.get('image')
        image_filename = None
        if image_file and image_file.filename != '' and allowed_file(image_file.filename):
            os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
            filename = secure_filename(image_file.filename)
            filename = datetime.now().strftime("%Y%m%d%H%M%S_") + filename
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            image_file.save(image_path)
            image_filename = filename
        new_loc = Location(name=name, responsible_id=responsible_id if responsible_id else None, notes=notes, image=image_filename)
        db.session.add(new_loc)
        db.session.commit()
        # è®°å½•æ—¥å¿—
        log = Log(user_id=current_user.id, location_id=new_loc.id, action_type="æ–°å¢ä½ç½®", details=f"Added location {new_loc.name}")
        db.session.add(log)
        db.session.commit()
        flash('å®éªŒå®¤ä½ç½®å·²æ·»åŠ ', 'success')
        return redirect(url_for('locations_list'))
    members = Member.query.all()
    return render_template('location_form.html', members=members, location=None)

@app.route('/locations/<int:loc_id>/delete', methods=['POST'])
@login_required
def delete_location(loc_id):
    location = Location.query.get_or_404(loc_id)
    db.session.delete(location)
    db.session.commit()
    # è®°å½•æ—¥å¿—
    log = Log(user_id=current_user.id, location_id=loc_id, action_type="åˆ é™¤ä½ç½®", details=f"Deleted location {location.name}")
    db.session.add(log)
    db.session.commit()
    flash('å®éªŒå®¤ä½ç½®å·²åˆ é™¤', 'info')
    return redirect(url_for('locations_list'))

@app.route('/locations/<int:loc_id>/edit', methods=['GET', 'POST'])
@login_required
def edit_location(loc_id):
    location = Location.query.get_or_404(loc_id)
    if request.method == 'POST':
        # æ›´æ–°ä½ç½®ä¿¡æ¯
        location.name = request.form.get('name')
        location.responsible_id = request.form.get('responsible_id')
        location.notes = request.form.get('notes')
        image_file = request.files.get('image')
        if image_file and image_file.filename != '' and allowed_file(image_file.filename):
            os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
            filename = secure_filename(image_file.filename)
            filename = datetime.now().strftime("%Y%m%d%H%M%S_") + filename
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            image_file.save(image_path)
            location.image = filename
        location.last_modified = datetime.utcnow()
        db.session.commit()
        # è®°å½•æ—¥å¿—
        log = Log(user_id=current_user.id, location_id=location.id, action_type="ä¿®æ”¹ä½ç½®", details=f"Edited location {location.name}")
        db.session.add(log)
        db.session.commit()
        flash('ä½ç½®ä¿¡æ¯å·²æ›´æ–°', 'success')
        return redirect(url_for('locations_list'))
    members = Member.query.all()
    return render_template('location_form.html', members=members, location=location)

@app.route('/locations/<int:loc_id>')
@login_required
def view_location(loc_id):
    location = Location.query.get_or_404(loc_id)
    # è·å–è¯¥ä½ç½®åŒ…å«çš„æ‰€æœ‰ç‰©å“åŠå…¶åæ ‡
    items_at_location = Item.query.filter_by(location_id=loc_id).all()
    return render_template('location.html', location=location, items=items_at_location)

@app.route('/locations/<int:loc_id>/set_item_position', methods=['POST'])
@login_required
def set_item_position(loc_id):
    # AJAX/è¡¨å•æäº¤ç‰©å“åæ ‡æ ‡è®°
    item_id = request.form.get('item_id')
    pos_x = request.form.get('pos_x')
    pos_y = request.form.get('pos_y')
    item = Item.query.get_or_404(item_id)
    if item.location_id == loc_id:
        try:
            item.pos_x = float(pos_x)
            item.pos_y = float(pos_y)
        except:
            item.pos_x = None
            item.pos_y = None
        db.session.commit()
        log = Log(user_id=current_user.id, item_id=item.id, action_type="æ ‡è®°ä½ç½®", details=f"Set position for item {item.name} in location {loc_id}")
        db.session.add(log)
        db.session.commit()
        flash(f"ç‰©å“ {item.name} çš„ä½ç½®å·²æ›´æ–°", "success")
    else:
        flash("æ— æ•ˆçš„ç‰©å“æˆ–ä½ç½®", "danger")
    return redirect(url_for('view_location', loc_id=loc_id))

@app.route('/members')
@login_required
def members_list():
    members = Member.query.order_by(Member.name).all()
    return render_template('members.html', members=members)

@app.route('/member/<int:member_id>')
@login_required
def profile(member_id):
    member = Member.query.get_or_404(member_id)
    # è¯¥æˆå‘˜è´Ÿè´£çš„ç‰©å“å’Œä½ç½®åˆ—è¡¨
    items_resp = Item.query.filter_by(responsible_id=member.id).all()
    locations_resp = Location.query.filter_by(responsible_id=member.id).all()
    # é€šçŸ¥åˆ—è¡¨ï¼šä»–äººå¯¹è¯¥æˆå‘˜è´Ÿè´£çš„ç‰©å“/ä½ç½®çš„æœ€è¿‘æ›´æ–°
    notifications = []
    if member.id == current_user.id:
        from sqlalchemy import or_
        notifications = Log.query.join(Item, Log.item_id == Item.id, isouter=True) \
                        .join(Location, Log.location_id == Location.id, isouter=True) \
                        .filter(or_(Item.responsible_id == member.id, Location.responsible_id == member.id), Log.user_id != member.id) \
                        .order_by(Log.timestamp.desc()).limit(5).all()
    # ç•™è¨€æ¿æ¶ˆæ¯åˆ—è¡¨ï¼ˆå‘é€ç»™è¯¥æˆå‘˜çš„ç•™è¨€ï¼‰
    messages = Message.query.filter_by(receiver_id=member.id).order_by(Message.timestamp.desc()).all()
    # å½“å‰ç”¨æˆ·è‡ªå·±çš„æ“ä½œè®°å½•ï¼ˆä»…æŸ¥çœ‹è‡ªå·±çš„ä¸»é¡µæ—¶æ˜¾ç¤ºï¼‰
    user_logs = []
    if member.id == current_user.id:
        user_logs = Log.query.filter_by(user_id=member.id).order_by(Log.timestamp.desc()).limit(5).all()
    return render_template('profile.html', profile_user=member, items_resp=items_resp, locations_resp=locations_resp, notifications=notifications, messages=messages, user_logs=user_logs)

@app.route('/member/<int:member_id>/edit', methods=['GET', 'POST'])
@login_required
def edit_profile(member_id):
    if current_user.id != member_id:
        flash('æ— æƒç¼–è¾‘ä»–äººä¿¡æ¯', 'danger')
        return redirect(url_for('profile', member_id=member_id))
    member = Member.query.get_or_404(member_id)
    if request.method == 'POST':
        # æ›´æ–°ä¸ªäººä¿¡æ¯
        member.name = request.form.get('name')
        member.contact = request.form.get('contact')
        member.notes = request.form.get('notes')
        # å¦‚å¡«å†™äº†æ–°å¯†ç åˆ™æ›´æ–°å¯†ç 
        new_password = request.form.get('password')
        if new_password and new_password.strip() != '':
            member.set_password(new_password)
        # æ›´æ–°å¤´åƒ
        image_file = request.files.get('photo')
        if image_file and image_file.filename != '' and allowed_file(image_file.filename):
            os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
            filename = secure_filename(image_file.filename)
            filename = datetime.now().strftime("%Y%m%d%H%M%S_") + filename
            image_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            image_file.save(image_path)
            member.photo = filename
        member.last_modified = datetime.utcnow()
        db.session.commit()
        flash('ä¸ªäººä¿¡æ¯å·²æ›´æ–°', 'success')
        return redirect(url_for('profile', member_id=member_id))
    return render_template('edit_profile.html', member=member)

@app.route('/message/<int:member_id>', methods=['POST'])
@login_required
def post_message(member_id):
    # æäº¤ç•™è¨€
    receiver = Member.query.get_or_404(member_id)
    content = request.form.get('content')
    if content and content.strip() != '':
        msg = Message(sender_id=current_user.id, receiver_id=receiver.id, content=content.strip())
        db.session.add(msg)
        db.session.commit()
        flash('ç•™è¨€å·²å‘å¸ƒ', 'success')
    return redirect(url_for('profile', member_id=member_id))

@app.route('/export/<string:datatype>')
@login_required
def export_data(datatype):
    # å¯¼å‡ºæ•°æ®ä¸º CSV æ–‡ä»¶
    import pandas as pd
    filename = f"export_{datatype}.csv"
    if datatype == 'items':
        df = pd.read_sql(Item.query.statement, db.session.bind)
    elif datatype == 'members':
        df = pd.read_sql(Member.query.statement, db.session.bind)
    elif datatype == 'locations':
        df = pd.read_sql(Location.query.statement, db.session.bind)
    elif datatype == 'logs':
        df = pd.read_sql(Log.query.statement, db.session.bind)
    elif datatype == 'messages':
        df = pd.read_sql(Message.query.statement, db.session.bind)
    else:
        flash('æœªçŸ¥æ•°æ®ç±»å‹', 'warning')
        return redirect(url_for('index'))
    df.to_csv(filename, index=False)
    return send_file(filename, as_attachment=True, mimetype='text/csv', download_name=filename)

if __name__ == '__main__':
    app.run(debug=False)

# templates/base.html

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åŒ–å­¦å®éªŒå®¤ç®¡ç†ç³»ç»Ÿ</title>
  <!-- å¼•å…¥ Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* å›¾é’‰å›¾æ ‡çš„æ ·å¼ */
    .pin-icon {
      position: absolute;
      transform: translate(-50%, -100%);
      font-size: 24px;
      cursor: pointer;
    }
    .pin-icon:hover {
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('index') }}">å®éªŒå®¤ç®¡ç†ç³»ç»Ÿ</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          {% if current_user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('items') }}">ç‰©å“ç®¡ç†</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('locations_list') }}">å®éªŒå®¤ä½ç½®</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('members_list') }}">è¯¾é¢˜ç»„æˆå‘˜</a>
          </li>
          {% endif %}
        </ul>
        <ul class="navbar-nav ms-auto">
          {% if current_user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button" data-bs-toggle="dropdown">
              {{ current_user.name or current_user.username }}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
              <li><a class="dropdown-item" href="{{ url_for('profile', member_id=current_user.id) }}">ä¸ªäººä¸»é¡µ</a></li>
              <li><a class="dropdown-item" href="{{ url_for('edit_profile', member_id=current_user.id) }}">ç¼–è¾‘ä¸ªäººä¿¡æ¯</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="{{ url_for('logout') }}">é€€å‡º</a></li>
            </ul>
          </li>
          {% else %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">ç™»å½•</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('register') }}">æ³¨å†Œ</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>
  <!-- æç¤ºæ¶ˆæ¯ -->
  <div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>
  <!-- ä¸»å†…å®¹ -->
  <div class="container mt-4">
    {% block content %}{% endblock %}
  </div>

  <!-- å¼•å…¥ Bootstrap JS (å« Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- å¯ç”¨ Bootstrap å·¥å…·æç¤ºï¼ˆå¦‚éœ€ï¼‰ -->
  <script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  </script>
</body>
</html>

# templates/login.html

{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-4">
    <h3 class="mb-4">ç”¨æˆ·ç™»å½•</h3>
    <form method="post" action="{{ url_for('login') }}">
      <div class="mb-3">
        <label for="username" class="form-label">ç”¨æˆ·å</label>
        <input type="text" class="form-control" id="username" name="username" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">å¯†ç </label>
        <input type="password" class="form-control" id="password" name="password" required>
      </div>
      <button type="submit" class="btn btn-primary">ç™»å½•</button>
      <a href="{{ url_for('register') }}" class="btn btn-link">æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ</a>
    </form>
  </div>
</div>
{% endblock %}

templates/register.html

{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-4">
    <h3 class="mb-4">ç”¨æˆ·æ³¨å†Œ</h3>
    <form method="post" action="{{ url_for('register') }}">
      <div class="mb-3">
        <label for="name" class="form-label">å§“å</label>
        <input type="text" class="form-control" id="name" name="name" required>
      </div>
      <div class="mb-3">
        <label for="username" class="form-label">ç”¨æˆ·å</label>
        <input type="text" class="form-control" id="username" name="username" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">å¯†ç </label>
        <input type="password" class="form-control" id="password" name="password" required>
      </div>
      <div class="mb-3">
        <label for="contact" class="form-label">è”ç³»æ–¹å¼ (é‚®ç®±æˆ–ç”µè¯)</label>
        <input type="text" class="form-control" id="contact" name="contact">
      </div>
      <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
      <a href="{{ url_for('login') }}" class="btn btn-link">å·²æœ‰è´¦å·ï¼Ÿç™»å½•</a>
    </form>
  </div>
</div>
{% endblock %}

# templates/items.html

{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">ç‰©å“åˆ—è¡¨</h3>
<form class="row g-3 mb-3" method="get" action="{{ url_for('items') }}">
  <div class="col-auto">
    <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="æœç´¢ç‰©å“...">
  </div>
  <div class="col-auto">
    <select name="category" class="form-select">
      <option value="">å…¨éƒ¨ç±»åˆ«</option>
      {% for cat in categories %}
      <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-secondary">ç­›é€‰</button>
  </div>
  <div class="col-auto ms-auto">
    <a href="{{ url_for('add_item') }}" class="btn btn-primary">æ–°å¢ç‰©å“</a>
  </div>
</form>
<table class="table table-hover">
  <thead class="table-light">
    <tr>
      <th>åç§°</th><th>ç±»åˆ«</th><th>çŠ¶æ€</th><th>å­˜æ”¾ä½ç½®</th><th>è´Ÿè´£äºº</th><th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    {%- set row_class = "" -%}
    {% if item.status %}
      {% if 'ç”¨å®Œ' in item.status %}
        {% set row_class = 'table-danger' %}
      {% elif 'å°‘é‡' in item.status %}
        {% set row_class = 'table-warning' %}
      {% elif 'å……è¶³' in item.status %}
        {% set row_class = 'table-success' %}
      {% endif %}
    {% endif %}
    <tr class="{{ row_class }}">
      <td><a href="{{ url_for('item_detail', item_id=item.id) }}">{{ item.name }}</a></td>
      <td>{{ item.category or '' }}</td>
      <td>{{ item.status or '' }}</td>
      <td>
        {% if item.location %}
          <a href="{{ url_for('view_location', loc_id=item.location.id) }}">{{ item.location.name }}</a>
        {% else %}-{% endif %}
      </td>
      <td>
        {% if item.responsible_member %}
          <a href="{{ url_for('profile', member_id=item.responsible_member.id) }}">{{ item.responsible_member.name }}</a>
        {% else %}-{% endif %}
      </td>
      <td>
        <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-sm btn-outline-primary">ç¼–è¾‘</a>
        <form action="{{ url_for('delete_item', item_id=item.id) }}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥ç‰©å“å—ï¼Ÿ');">
          <button type="submit" class="btn btn-sm btn-outline-danger">åˆ é™¤</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    {% if items|length == 0 %}
    <tr><td colspan="6" class="text-center text-muted">æ²¡æœ‰æ‰¾åˆ°ç‰©å“</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}

# templates/item_form.html

{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ item and item.id and 'ç¼–è¾‘ç‰©å“' or 'æ–°å¢ç‰©å“' }}</h4>
<form method="post" enctype="multipart/form-data" action="{% if item %}{{ url_for('edit_item', item_id=item.id) }}{% else %}{{ url_for('add_item') }}{% endif %}">
  <div class="mb-3">
    <label for="name" class="form-label">ç‰©å“åç§°</label>
    <input type="text" class="form-control" id="name" name="name" value="{{ item.name if item else '' }}" required>
  </div>
  <div class="mb-3">
    <label for="category" class="form-label">ç±»åˆ«</label>
    <input type="text" class="form-control" id="category" name="category" value="{{ item.category if item else '' }}">
  </div>
  <div class="mb-3">
    <label for="status" class="form-label">çŠ¶æ€</label>
    <select id="status" name="status" class="form-select">
      <option value="" {% if not item or not item.status %}selected{% endif %}>--é€‰æ‹©çŠ¶æ€--</option>
      <optgroup label="åº“å­˜çŠ¶æ€">
        <option value="å……è¶³" {% if item and item.status == 'å……è¶³' %}selected{% endif %}>å……è¶³</option>
        <option value="å°‘é‡" {% if item and item.status == 'å°‘é‡' %}selected{% endif %}>å°‘é‡</option>
        <option value="ç”¨å®Œ" {% if item and item.status == 'ç”¨å®Œ' %}selected{% endif %}>ç”¨å®Œ</option>
        <option value="èˆå¼ƒ" {% if item and item.status == 'èˆå¼ƒ' %}selected{% endif %}>èˆå¼ƒ</option>

      </optgroup>
      <optgroup label="ç‰©å“ç‰¹æ€§">
        <option value="å®‰å…¨" {% if item and item.status == 'å®‰å…¨' %}selected{% endif %}>å®‰å…¨</option>
        <option value="æ³¨æ„" {% if item and item.status == 'æ³¨æ„' %}selected{% endif %}>æ³¨æ„</option>
        <option value="å±é™©" {% if item and item.status == 'å±é™©' %}selected{% endif %}>å±é™©</option>
      </optgroup>
      <optgroup label="ä»·å€¼">
        <option value="ä¾¿å®œ" {% if item and item.status == 'ä¾¿å®œ' %}selected{% endif %}>ä¾¿å®œ</option>
        <option value="ä¸€èˆ¬" {% if item and item.status == 'ä¸€èˆ¬' %}selected{% endif %}>ä¸€èˆ¬</option>
        <option value="æ˜‚è´µ" {% if item and item.status == 'æ˜‚è´µ' %}selected{% endif %}>æ˜‚è´µ</option>
      </optgroup>
      {% if item and item.status not in ['å……è¶³','å°‘é‡','ç”¨å®Œ','èˆå¼ƒ','å®‰å…¨','æ³¨æ„','å±é™©','ä¾¿å®œ','ä¸€èˆ¬','æ˜‚è´µ'] and item.status %}
      <!-- ä¿ç•™ç¼–è¾‘æ—¶çš„å…¶ä»–çŠ¶æ€é€‰é¡¹ -->
      <option value="{{ item.status }}" selected>{{ item.status }}</option>
      {% endif %}
    </select>
  </div>
  <div class="mb-3">
    <label for="responsible" class="form-label">è´Ÿè´£äºº</label>
    <select id="responsible" name="responsible_id" class="form-select">
      <option value="">(æœªæŒ‡å®š)</option>
      {% for m in members %}
      <option value="{{ m.id }}" {% if item and item.responsible_id == m.id %}selected{% endif %}>{{ m.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label for="responsible" class="form-label">è´Ÿè´£äºº</label>
    <select id="responsible" name="responsible_id" class="form-select">
      <option value="">(æœªæŒ‡å®š)</option>
      {% for m in members %}
      <option value="{{ m.id }}" {% if item and item.responsible_id == m.id %}selected{% endif %}>{{ m.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label for="location" class="form-label">å­˜æ”¾ä½ç½®</label>
    <select id="location" name="location_id" class="form-select">
      <option value="">(æœªæŒ‡å®š)</option>
      {% for loc in locations %}
      <option value="{{ loc.id }}" {% if item and item.location_id == loc.id %}selected{% endif %}>{{ loc.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label for="purchase_link" class="form-label">è´­ä¹°é“¾æ¥</label>
    <input type="url" class="form-control" id="purchase_link" name="purchase_link" value="{{ item.purchase_link if item else '' }}">
  </div>
  <div class="mb-3">
    <label for="imageInput" class="form-label">ç‰©å“å›¾ç‰‡ (å¯é€‰)</label>
    {% if item and item.image %}
    <div class="mb-2">
      <img src="{{ url_for('static', filename='images/' + item.image) }}" alt="ç‰©å“å›¾ç‰‡" class="img-thumbnail" style="max-width:150px;">
    </div>
    {% endif %}
    <input type="file" id="imageInput" name="image" accept="image/*" capture="environment" class="form-control">
    <img id="imgPreview" src="#" alt="é¢„è§ˆ" style="max-width: 120px; display: none; margin-top: 5px;">
  </div>
  <div class="mb-3">
    <label for="notes" class="form-label">å¤‡æ³¨</label>
    <textarea class="form-control" id="notes" name="notes" rows="3">{{ item.notes if item else '' }}</textarea>
  </div>
  <button type="submit" class="btn btn-success">{{ item and 'ä¿å­˜ä¿®æ”¹' or 'æ·»åŠ ç‰©å“' }}</button>
  <a href="{{ url_for('items') }}" class="btn btn-secondary">å–æ¶ˆ</a>
</form>
<script>
  // å›¾ç‰‡é¢„è§ˆè„šæœ¬
  const fileInput = document.getElementById('imageInput');
  const previewImg = document.getElementById('imgPreview');
  if(fileInput && previewImg) {
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
        previewImg.src = URL.createObjectURL(file);
        previewImg.style.display = 'block';
      } else {
        previewImg.style.display = 'none';
      }
    });
  }
</script>
{% endblock %}

# templates/item_detail.html

{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">ç‰©å“è¯¦æƒ…</h4>
<div class="row">
  <div class="col-md-6">
    <ul class="list-group mb-3">
      <li class="list-group-item"><strong>åç§°:</strong> {{ item.name }}</li>
      <li class="list-group-item"><strong>ç±»åˆ«:</strong> {{ item.category or 'æœªåˆ†ç±»' }}</li>
      <li class="list-group-item"><strong>çŠ¶æ€:</strong> {{ item.status or 'æœªæŒ‡å®š' }}</li>
      <li class="list-group-item"><strong>è´Ÿè´£äºº:</strong>
        {% if item.responsible_member %}
          <a href="{{ url_for('profile', member_id=item.responsible_member.id) }}">{{ item.responsible_member.name }}</a>
        {% else %} æ—  {% endif %}
      </li>
      <li class="list-group-item"><strong>å­˜æ”¾ä½ç½®:</strong>
        {% if item.location %}
          <a href="{{ url_for('view_location', loc_id=item.location.id) }}">{{ item.location.name }}</a>
        {% else %} æœªæŒ‡å®š {% endif %}
      </li>
      <li class="list-group-item"><strong>æœ€è¿‘æ›´æ–°æ—¶é—´:</strong> {{ item.last_modified.strftime("%Y-%m-%d %H:%M:%S") if item.last_modified else '' }}</li>
      {% if item.purchase_link %}
      <li class="list-group-item"><strong>è´­ä¹°é“¾æ¥:</strong> <a href="{{ item.purchase_link }}" target="_blank">ç‚¹å‡»æ‰“å¼€</a></li>
      {% endif %}
      {% if item.notes %}
      <li class="list-group-item"><strong>å¤‡æ³¨:</strong><br>{{ item.notes }}</li>
      {% endif %}
    </ul>
    <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-primary">ç¼–è¾‘</a>
    <form action="{{ url_for('delete_item', item_id=item.id) }}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥ç‰©å“å—ï¼Ÿ');">
      <button type="submit" class="btn btn-danger">åˆ é™¤</button>
    </form>
    <a href="{{ url_for('items') }}" class="btn btn-secondary">è¿”å›åˆ—è¡¨</a>
  </div>
  <div class="col-md-6">
    {% if item.image %}
      <img src="{{ url_for('static', filename='images/' + item.image) }}" alt="ç‰©å“å›¾ç‰‡" class="img-fluid img-thumbnail">
    {% else %}
      <p class="text-muted">æ— å›¾ç‰‡</p>
    {% endif %}
  </div>
</div>
{% endblock %}

# templates/locations.html

{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">å®éªŒå®¤ä½ç½®åˆ—è¡¨</h3>
<a href="{{ url_for('add_location') }}" class="btn btn-primary mb-3">æ–°å¢ä½ç½®</a>
<table class="table table-hover">
  <thead class="table-light">
    <tr><th>åç§°</th><th>è´Ÿè´£äºº</th><th>åŒ…å«ç‰©å“æ•°é‡</th><th>æ“ä½œ</th></tr>
  </thead>
  <tbody>
    {% for loc in locations %}
    <tr>
      <td><a href="{{ url_for('view_location', loc_id=loc.id) }}">{{ loc.name }}</a></td>
      <td>
        {% if loc.responsible_member %}
          <a href="{{ url_for('profile', member_id=loc.responsible_member.id) }}">{{ loc.responsible_member.name }}</a>
        {% else %} - {% endif %}
      </td>
      <td>{{ loc.items|length }}</td>
      <td>
        <a href="{{ url_for('edit_location', loc_id=loc.id) }}" class="btn btn-sm btn-outline-primary">ç¼–è¾‘</a>
        <form action="{{ url_for('delete_location', loc_id=loc.id) }}" method="post" class="d-inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥ä½ç½®å—ï¼Ÿ');">
          <button type="submit" class="btn btn-sm btn-outline-danger">åˆ é™¤</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    {% if locations|length == 0 %}
    <tr><td colspan="4" class="text-center text-muted">æš‚æ— ä½ç½®è®°å½•</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}

# templates/location_form.html

{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ location and 'ç¼–è¾‘ä½ç½®' or 'æ–°å¢ä½ç½®' }}</h4>
<form method="post" enctype="multipart/form-data" action="{% if location %}{{ url_for('edit_location', loc_id=location.id) }}{% else %}{{ url_for('add_location') }}{% endif %}">
  <div class="mb-3">
    <label for="name" class="form-label">ä½ç½®åç§°</label>
    <input type="text" class="form-control" id="name" name="name" value="{{ location.name if location else '' }}" required>
  </div>
  <div class="mb-3">
    <label for="responsible" class="form-label">è´Ÿè´£äºº</label>
    <select id="responsible" name="responsible_id" class="form-select">
      <option value="">(æœªæŒ‡å®š)</option>
      {% for m in members %}
      <option value="{{ m.id }}" {% if location and location.responsible_id == m.id %}selected{% endif %}>{{ m.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label for="imageInput" class="form-label">ä½ç½®å›¾ç‰‡ (å¯é€‰)</label>
    {% if location and location.image %}
    <div class="mb-2">
      <img src="{{ url_for('static', filename='images/' + location.image) }}" alt="ä½ç½®å›¾ç‰‡" class="img-thumbnail" style="max-width:150px;">
    </div>
    {% endif %}
    <input type="file" id="imageInput" name="image" accept="image/*" capture="environment" class="form-control">
    <img id="imgPreview" src="#" alt="é¢„è§ˆ" style="max-width: 120px; display: none; margin-top: 5px;">
  </div>
  <div class="mb-3">
    <label for="notes" class="form-label">å¤‡æ³¨</label>
    <textarea class="form-control" id="notes" name="notes" rows="3">{{ location.notes if location else '' }}</textarea>
  </div>
  <button type="submit" class="btn btn-success">{{ location and 'ä¿å­˜ä¿®æ”¹' or 'æ·»åŠ ä½ç½®' }}</button>
  <a href="{{ url_for('locations_list') }}" class="btn btn-secondary">å–æ¶ˆ</a>
</form>
<script>
  // å›¾ç‰‡é¢„è§ˆè„šæœ¬
  const fileInput2 = document.getElementById('imageInput');
  const previewImg2 = document.getElementById('imgPreview');
  if(fileInput2 && previewImg2) {
    fileInput2.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
        previewImg2.src = URL.createObjectURL(file);
        previewImg2.style.display = 'block';
      } else {
        previewImg2.style.display = 'none';
      }
    });
  }
</script>
{% endblock %}

# templates/location.html

{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ location.name }}</h4>
<p>è´Ÿè´£äºº:
  {% if location.responsible_member %}
    <a href="{{ url_for('profile', member_id=location.responsible_member.id) }}">{{ location.responsible_member.name }}</a>
  {% else %} æ—  {% endif %}
  {% if location.notes %}
  <br><small class="text-muted">{{ location.notes }}</small>
  {% endif %}
</p>
{% if location.image %}
  <div class="mb-3">
    <div class="position-relative border" style="display: inline-block;">
      <img id="locationImg" src="{{ url_for('static', filename='images/' + location.image) }}" alt="{{ location.name }}" class="img-fluid">
      {% for it in items %}
        {% if it.pos_x is not none and it.pos_y is not none %}
        <a href="{{ url_for('item_detail', item_id=it.id) }}" class="pin-icon" style="left: {{ it.pos_x }}%; top: {{ it.pos_y }}%;" title="{{ it.name }}">ğŸ“Œ</a>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {% set items_no_pos = items|selectattr("pos_x", "==", none) | list %}
  {% if items_no_pos %}
  <form method="post" action="{{ url_for('set_item_position', loc_id=location.id) }}" class="mb-4">
    <div class="row align-items-center">
      <div class="col-auto">
        <label for="itemSelect" class="form-label mb-0">å°†ç‰©å“æ ‡è®°åœ¨å›¾ä¸­:</label>
      </div>
      <div class="col-auto">
        <select id="itemSelect" name="item_id" class="form-select">
          {% for it in items_no_pos %}
          <option value="{{ it.id }}">{{ it.name }}</option>
          {% endfor %}
        </select>
      </div>
      <input type="hidden" name="pos_x" id="posX">
      <input type="hidden" name="pos_y" id="posY">
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">ä¿å­˜ä½ç½®</button>
      </div>
      <div class="col-12">
        <small class="text-muted">ç‚¹å‡»ä¸Šæ–¹å›¾ç‰‡é€‰æ‹©ä½ç½®ï¼Œç„¶åç‚¹å‡»ä¿å­˜</small>
      </div>
    </div>
  </form>
  <script>
    // ç‚¹å‡»å›¾ç‰‡è·å–åæ ‡è„šæœ¬
    const locImg = document.getElementById('locationImg');
    if(locImg) {
      locImg.addEventListener('click', function(e) {
        const rect = locImg.getBoundingClientRect();
        const xPercent = ((e.clientX - rect.left) / rect.width) * 100;
        const yPercent = ((e.clientY - rect.top) / rect.height) * 100;
        const posXInput = document.getElementById('posX');
        const posYInput = document.getElementById('posY');
        if(posXInput && posYInput) {
          posXInput.value = xPercent.toFixed(2);
          posYInput.value = yPercent.toFixed(2);
        }
      });
    }
  </script>
  {% endif %}
{% else %}
  <p class="text-muted">æ— å›¾ç‰‡</p>
{% endif %}
<h5 class="mt-4">åŒ…å«çš„ç‰©å“</h5>
<ul class="list-group">
  {% for it in items %}
    <li class="list-group-item">
      {% if it.pos_x is not none and it.pos_y is not none %}ğŸ“Œ {% endif %}
      <a href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.name }}</a>
      {% if it.status %}<span class="badge bg-secondary">{{ it.status }}</span>{% endif %}
      {% if it.responsible_member %}<small class="text-muted"> - {{ it.responsible_member.name }}</small>{% endif %}
    </li>
  {% else %}
    <li class="list-group-item text-muted">ï¼ˆæ­¤ä½ç½®æš‚æ— ç‰©å“ï¼‰</li>
  {% endfor %}
</ul>
{% endblock %}

# templates/members.html

{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">è¯¾é¢˜ç»„æˆå‘˜</h3>
<table class="table table-hover">
  <thead class="table-light">
    <tr><th>å§“å</th><th>ç”¨æˆ·å</th><th>è”ç³»æ–¹å¼</th><th>è´Ÿè´£ç‰©å“æ•°</th><th>è´Ÿè´£ä½ç½®æ•°</th></tr>
  </thead>
  <tbody>
    {% for mem in members %}
    <tr>
      <td><a href="{{ url_for('profile', member_id=mem.id) }}">{{ mem.name }}</a></td>
      <td>{{ mem.username }}</td>
      <td>{{ mem.contact or '-' }}</td>
      <td>{{ mem.items|length }}</td>
      <td>{{ mem.locations|length }}</td>
    </tr>
    {% endfor %}
    {% if members|length == 0 %}
    <tr><td colspan="5" class="text-center text-muted">æš‚æ— æˆå‘˜</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}

# templates/profile.html

{% extends "base.html" %}
{% block content %}
<div class="mb-4">
  <div class="row">
    <div class="col-auto">
      {% if profile_user.photo %}
      <img src="{{ url_for('static', filename='images/' + profile_user.photo) }}" alt="å¤´åƒ" class="img-thumbnail" style="width:100px; height:100px; object-fit: cover;">
      {% else %}
      <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded" style="width:100px; height:100px;">
        <span style="font-size:50px;">&#128100;</span>
      </div>
      {% endif %}
    </div>
    <div class="col">
      <h4>{{ profile_user.name }}</h4>
      <p>
        {% if profile_user.contact %}ğŸ“ {{ profile_user.contact }}<br>{% endif %}
        {% if profile_user.notes %}<small class="text-muted">{{ profile_user.notes }}</small>{% endif %}
      </p>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
    <h5>è´Ÿè´£çš„ç‰©å“</h5>
    <ul class="list-group mb-4">
      {% for it in items_resp %}
      <li class="list-group-item">
        <a href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.name }}</a>
        {% if it.status %}<span class="badge bg-secondary">{{ it.status }}</span>{% endif %}
      </li>
      {% else %}
      <li class="list-group-item text-muted">æ— è´Ÿè´£ç‰©å“</li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-md-6">
    <h5>è´Ÿè´£çš„ä½ç½®</h5>
    <ul class="list-group mb-4">
      {% for loc in locations_resp %}
      <li class="list-group-item">
        <a href="{{ url_for('view_location', loc_id=loc.id) }}">{{ loc.name }}</a>
      </li>
      {% else %}
      <li class="list-group-item text-muted">æ— è´Ÿè´£ä½ç½®</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% if current_user.id == profile_user.id %}
<div class="mb-4">
  <h5>é€šçŸ¥</h5>
  <ul class="list-group">
    {% for log in notifications %}
    {% set verb = 'è¿›è¡Œäº†æ“ä½œ' %}
    {% if 'æ–°å¢' in log.action_type %}{% set verb = 'æ·»åŠ äº†' %}{% elif 'ä¿®æ”¹' in log.action_type %}{% set verb = 'ä¿®æ”¹äº†' %}{% elif 'åˆ é™¤' in log.action_type %}{% set verb = 'åˆ é™¤äº†' %}{% endif %}
    <li class="list-group-item">
      ä½ çš„{% if log.item_id %}ç‰©å“{% elif log.location_id %}ä½ç½®{% endif %}
      <strong>
      {% if log.item_id %}<a href="{{ url_for('item_detail', item_id=log.item.id) }}">{{ log.item.name }}</a>
      {% elif log.location_id %}<a href="{{ url_for('view_location', loc_id=log.location.id) }}">{{ log.location.name }}</a>
      {% endif %}
      </strong>
      è¢« {{ log.user.name if log.user else 'æŸäºº' }} {{ verb }}
      <small class="text-muted">({{ log.timestamp.strftime("%Y-%m-%d %H:%M") }})</small>
    </li>
    {% else %}
    <li class="list-group-item text-muted">æš‚æ— é€šçŸ¥</li>
    {% endfor %}
  </ul>
</div>
<div class="mb-4">
  <h5>æˆ‘çš„æ“ä½œè®°å½•</h5>
  <ul class="list-group">
    {% for log in user_logs %}
    <li class="list-group-item">
      <small class="text-muted">{{ log.timestamp.strftime("%Y-%m-%d %H:%M") }}</small>
      {% if log.item %}
        - {{ log.action_type }}: <a href="{{ url_for('item_detail', item_id=log.item.id) }}">{{ log.item.name }}</a>
      {% elif log.location %}
        - {{ log.action_type }}: <a href="{{ url_for('view_location', loc_id=log.location.id) }}">{{ log.location.name }}</a>
      {% else %}
        - {{ log.action_type }}
      {% endif %}
    </li>
    {% else %}
    <li class="list-group-item text-muted">æš‚æ— æ“ä½œè®°å½•</li>
    {% endfor %}
  </ul>
</div>
{% endif %}
<div class="mb-4">
  <h5>ç•™è¨€æ¿</h5>
  <ul class="list-group mb-3">
    {% for msg in messages %}
    <li class="list-group-item">
      <strong>{{ msg.sender.name if msg.sender else 'åŒ¿å' }}:</strong> {{ msg.content }}
      <br><small class="text-muted">{{ msg.timestamp.strftime("%Y-%m-%d %H:%M") }}</small>
    </li>
    {% else %}
    <li class="list-group-item text-muted">æš‚æ— ç•™è¨€</li>
    {% endfor %}
  </ul>
  <form method="post" action="{{ url_for('post_message', member_id=profile_user.id) }}">
    <div class="mb-3">
      <label for="newMessage" class="form-label">ç•™è¨€:</label>
      <textarea id="newMessage" name="content" class="form-control" rows="2" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">å‘å¸ƒç•™è¨€</button>
  </form>
</div>
{% endblock %}

# templates/edit_profile.html

{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">ç¼–è¾‘ä¸ªäººä¿¡æ¯</h4>
<form method="post" enctype="multipart/form-data" action="{{ url_for('edit_profile', member_id=member.id) }}">
  <div class="mb-3">
    <label for="name" class="form-label">å§“å</label>
    <input type="text" class="form-control" id="name" name="name" value="{{ member.name }}" required>
  </div>
  <div class="mb-3">
    <label for="contact" class="form-label">è”ç³»æ–¹å¼</label>
    <input type="text" class="form-control" id="contact" name="contact" value="{{ member.contact or '' }}">
  </div>
  <div class="mb-3">
    <label for="notes" class="form-label">ä¸ªäººå±•ç¤º/å¤‡æ³¨</label>
    <textarea class="form-control" id="notes" name="notes" rows="3">{{ member.notes or '' }}</textarea>
  </div>
  <div class="mb-3">
    <label for="password" class="form-label">æ–°å¯†ç  (ç•™ç©ºåˆ™ä¸ä¿®æ”¹)</label>
    <input type="password" class="form-control" id="password" name="password">
  </div>
  <div class="mb-3">
    <label for="photoInput" class="form-label">å¤´åƒ (å¯é€‰)</label>
    {% if member.photo %}
    <div class="mb-2">
      <img src="{{ url_for('static', filename='images/' + member.photo) }}" alt="å¤´åƒ" class="img-thumbnail" style="max-width:100px;">
    </div>
    {% endif %}
    <input type="file" id="photoInput" name="photo" accept="image/*" capture="user" class="form-control">
    <img id="photoPreview" src="#" alt="é¢„è§ˆ" style="max-width: 100px; display: none; margin-top: 5px;">
  </div>
  <button type="submit" class="btn btn-success">ä¿å­˜</button>
  <a href="{{ url_for('profile', member_id=member.id) }}" class="btn btn-secondary">å–æ¶ˆ</a>
</form>
<script>
  // å¤´åƒé¢„è§ˆè„šæœ¬
  const photoInput = document.getElementById('photoInput');
  const photoPreview = document.getElementById('photoPreview');
  if(photoInput && photoPreview) {
    photoInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
        photoPreview.src = URL.createObjectURL(file);
        photoPreview.style.display = 'block';
      } else {
        photoPreview.style.display = 'none';
      }
    });
  }
</script>
{% endblock %}

â¸»

âœ… requirements.txt

Flask>=3.0.0
Flask-Login>=0.6.3
Flask-SQLAlchemy>=3.1.1
Werkzeug>=3.0.1
pandas>=2.2.2

ğŸ“Œ æ‰€æœ‰ç‰ˆæœ¬ä¸º 2025 å¹´æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ˆFlask 3.xã€pandas 2.x ç­‰ï¼‰ï¼Œå…¼å®¹ Python 3.10+ã€‚

â¸»

âœ… macOS ç¯å¢ƒä¸‹è¿è¡ŒæŒ‡ä»¤ï¼ˆæ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼‰

ğŸ”¹ 1. åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆä¾‹å¦‚æ”¾åœ¨æ¡Œé¢ï¼‰

cd ~/Desktop
mkdir chem_lab_system
cd chem_lab_system

ğŸ”¹ 2. å»ºç«‹è™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»ï¼ˆæ¨èï¼‰

python3 -m venv venv
source venv/bin/activate

ğŸ”¹ 3. åˆ›å»ºå¹¶ä¿å­˜ requirements.txt æ–‡ä»¶

nano requirements.txt

å°†ä¸Šæ–¹å†…å®¹ç²˜è´´è¿›å»ï¼Œä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl + O â†’ å›è½¦ï¼ŒCtrl + Xï¼‰ã€‚

ğŸ”¹ 4. å®‰è£…ä¾èµ–

pip install -r requirements.txt

ğŸ”¹ 5. åˆ›å»ºç›®å½•ç»“æ„ï¼ˆå¦‚ä¸Šä¼ ç›®å½•ï¼‰

mkdir -p static/images templates

å°†æˆ‘ä¸Šé¢ç»™å‡ºçš„ Python æ–‡ä»¶ï¼ˆå¦‚ app.pyï¼‰ã€HTML æ¨¡æ¿ï¼ˆå¦‚ templates/base.htmlï¼‰æ”¾å…¥å¯¹åº”è·¯å¾„ã€‚

ğŸ”¹ 6. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆé¦–æ¬¡è¿è¡Œè‡ªåŠ¨ï¼‰

python app.py

ç»ˆç«¯å°†è¾“å‡ºï¼š

 * Running on http://127.0.0.1:5000

æµè§ˆå™¨è®¿é—®ï¼š
ğŸ‘‰ http://127.0.0.1:5000
åˆå§‹é»˜è®¤è´¦å·ä¸ºï¼š

ç”¨æˆ·åï¼šadmin
å¯†ç ï¼šadmin

ğŸ”¹ 7. ç”Ÿäº§æ¨¡å¼å…¬ç½‘å¯åŠ¨

flask run --host=0.0.0.0 --port=5000

gunicorn -w 3 -b 0.0.0.0:5000 app:app

â¸»

ğŸ”’ å…¶ä»–å»ºè®®

åŠŸèƒ½	è¯´æ˜
ä¸Šä¼ å›¾ç‰‡å¤§å°é™åˆ¶	é»˜è®¤æœ€å¤§ 16MBï¼Œå¯é€šè¿‡ app.config['MAX_CONTENT_LENGTH'] è°ƒæ•´
é™æ€æ–‡ä»¶è·¯å¾„	æ‰€æœ‰ä¸Šä¼ å›¾ç‰‡ä¿å­˜åœ¨ static/images/ ç›®å½•
æ•°æ®å¤‡ä»½å¯¼å‡º	æ”¯æŒé€šè¿‡ /export/items ç­‰è·¯å¾„å¯¼å‡º CSV æ–‡ä»¶
ç”Ÿäº§éƒ¨ç½²å»ºè®®	ä½¿ç”¨ gunicorn + Nginx å®ç°åç«¯éƒ¨ç½²


â¸»

âœ… ä¸€é”®ä¸Šä¼ é¡¹ç›®åˆ° GitHub çš„å®Œæ•´æ­¥éª¤

ä½ å·²ç»åœ¨æœ¬åœ°æœ‰äº†é¡¹ç›®ç›®å½•ï¼Œæ¯”å¦‚ï¼š~/Desktop/Benlab
å¹¶ä¸”ä½ å·²åœ¨è¯¥è·¯å¾„è¿è¡Œè¿‡ Flask é¡¹ç›®ï¼ˆä¾‹å¦‚åŒ…å« app.pyã€templates/ ç­‰ï¼‰ã€‚

ğŸ”¹ 1. æ‰“å¼€ç»ˆç«¯å¹¶è¿›å…¥é¡¹ç›®ç›®å½•

cd ~/Desktop/Benlab


â¸»

ğŸ”¹ 2. åˆå§‹åŒ– Git å¹¶æ·»åŠ è¿œç¨‹ä»“åº“

git init
git remote add origin https://github.com/Benjaminisgood/Benlab.git


â¸»

ğŸ”¹ 3. æ·»åŠ  .gitignore æ–‡ä»¶ï¼ˆå¿½ç•¥è™šæ‹Ÿç¯å¢ƒç­‰ï¼‰

echo "venv/" > .gitignore
echo "__pycache__/" >> .gitignore
echo "*.pyc" >> .gitignore
echo "*.sqlite3" >> .gitignore

æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªæ¨èæ¨¡æ¿ï¼šPython .gitignore æ¨¡æ¿

â¸»

ğŸ”¹ 4. æ·»åŠ é¡¹ç›®æ‰€æœ‰æ–‡ä»¶å¹¶æäº¤

git add .
git commit -m "ğŸ‰ Initial commit of chemical lab management system"


â¸»

ğŸ”¹ 5. æ¨é€åˆ° GitHub ä¸»åˆ†æ”¯ main

git branch -M main
git push -u origin main


â¸»

âœ… æœ€ç»ˆç»“æ„åº”ç±»ä¼¼ï¼š

Benlab/
â”œâ”€â”€ app.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html
â”‚   â”œâ”€â”€ login.html
â”‚   â”œâ”€â”€ items.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ static/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ .gitignore
â””â”€â”€ venv/  â† å·²è¢«å¿½ç•¥


â¸»

âœ… ä¹‹åæ›´æ–°é¡¹ç›®çš„æ–¹æ³•ï¼ˆå‘½ä»¤å›é¡¾ï¼‰

æ¯æ¬¡æ›´æ–°åï¼š

git add .
git commit -m "âœ¨ æ›´æ–°å†…å®¹è¯´æ˜"
git push

â¸»

ğŸ§ª Flask-Migrate æ•°æ®åº“è¿ç§»æµç¨‹

âœ… æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–

pip install flask-migrate

ç¡®ä¿ä½ çš„è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼Œå¦åˆ™å°±ä¼šè£…åˆ°å…¨å±€ç¯å¢ƒé‡Œã€‚

â¸»

âœ… æ­¥éª¤ 2ï¼šä¿®æ”¹ app.py æ”¯æŒ Flask-Migrate

åœ¨ app.py é‡ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼ˆä½ å·²å†™äº† db = SQLAlchemy(app)ï¼‰ï¼š

from flask_migrate import Migrate

# åœ¨ db åˆå§‹åŒ–ä¹‹ååŠ 
migrate = Migrate(app, db)


â¸»

âœ… æ­¥éª¤ 3ï¼šåˆå§‹åŒ–è¿ç§»ç›®å½•

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

export FLASK_APP=app.py  # Mac/Linux
# set FLASK_APP=app.py  # Windows

flask db init

ä¼šåˆ›å»ºä¸€ä¸ª migrations/ æ–‡ä»¶å¤¹ç”¨äºè·Ÿè¸ªè¿ç§»å†å²ã€‚

â¸»

âœ… æ­¥éª¤ 4ï¼šç”Ÿæˆåˆå§‹è¿ç§»è„šæœ¬

flask db migrate -m "Initial migration"

è¿™ä¸€æ­¥ä¼šæ ¹æ®æ¨¡å‹å˜åŒ–è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆä¸ä¼šç«‹å³ä¿®æ”¹æ•°æ®åº“ï¼‰ã€‚

â¸»

âœ… æ­¥éª¤ 5ï¼šåº”ç”¨è¿ç§»åˆ°æ•°æ®åº“

flask db upgrade

è¿™ä¸€æ­¥ä¼šæ ¹æ®ä¸Šä¸€æ­¥ç”Ÿæˆçš„è„šæœ¬ä¿®æ”¹ä½ çš„ SQLite æ•°æ®åº“ç»“æ„ï¼Œæ–°å¢å­—æ®µå¦‚ stock_status, features, value ç­‰å°±ä¼šæ­£å¼åŠ å…¥æ•°æ®åº“ç»“æ„ä¸­ã€‚

â¸»

ğŸ“Œ æ³¨æ„äº‹é¡¹
	â€¢	ä¹‹åä½ æ¯æ¬¡ä¿®æ”¹æ¨¡å‹ç±»ï¼ˆä¾‹å¦‚æ·»åŠ å­—æ®µï¼‰ï¼Œéƒ½åº”è¯¥æ‰§è¡Œï¼š

flask db migrate -m "Added xxx"
flask db upgrade

	â€¢	å¦‚æœæŠ¥é”™ â€œtarget database is not up to dateâ€ï¼Œå¯ä»¥ç”¨ï¼š

flask db stamp head


â¸»
# æœ€æ–°çš„æ„æ€
æˆ‘å…¶å®å¯ä»¥æ¥å…¥gptçš„APIï¼Œç®€åŒ–æ²¡æ¬¡ä¸Šä¼ æ•°æ®çš„æ“ä½œï¼Œåªéœ€è¦æ‹ä¸€å¼ ç…§ç‰‡ï¼Œè®©aiå»åˆ†æå¹¶å¡«å†™å†…å®¹ï¼Œæˆ‘å†æ£€æŸ¥ä¸€ä¸‹å­˜å‚¨ä½ç½®å³å¯ã€‚


{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">{{ location.name }}</h4>
<p>è´Ÿè´£äºº:
  {% if location.responsible_member %}
    <a href="{{ url_for('profile', member_id=location.responsible_member.id) }}">{{ location.responsible_member.name }}</a>
  {% else %} æ—  {% endif %}
  {% if location.notes %}
  <br><small class="text-muted">{{ location.notes }}</small>
  {% endif %}
</p>

<p>æœ€è¿‘ä¿®æ”¹ï¼š{{ location.last_modified.strftime('%Y-%m-%d %H:%M') if location.last_modified else 'æœªçŸ¥' }}</p>
{% macro render_children(parent) %}
<ul class="list-group mb-2 ms-3">
  {% for child in parent.children %}
    <li class="list-group-item">
      <a href="{{ url_for('view_location', loc_id=child.id) }}">{{ child.name }}</a>
      {% if child.children %}
        {{ render_children(child) }}
      {% endif %}
    </li>
  {% endfor %}
</ul>
{% endmacro %}

{% if location.children %}
  <h5 class="mt-4">å­åŒºåŸŸ</h5>
  {{ render_children(location) }}
{% endif %}
{% if location.clean_status %}
<p>å«ç”ŸçŠ¶æ€ï¼š
  <span class="badge 
      {% if location.clean_status == 'å¹²å‡€' %}bg-success
      {% elif location.clean_status == 'ä¸€èˆ¬' %}bg-warning text-dark
      {% elif location.clean_status == 'è„' %}bg-danger
      {% else %}bg-secondary
      {% endif %}
    ">
    {{ location.clean_status }}
  </span>
</p>
{% endif %}
<h5 class="mt-4">ç‰©å“ç»Ÿè®¡</h5>
<ul class="list-group mb-3">
  <li class="list-group-item">æ€»æ•°ï¼š<strong>{{ items|length }}</strong></li>
  {% for label, count in status_counter.items() %}
    <li class="list-group-item">{{ label }}ï¼š<span class="badge bg-info">{{ count }}</span></li>
  {% endfor %}
</ul>

{% if location.image %}
<div class="mb-3">
  <div class="position-relative border" id="mapWrapper" style="display: inline-block;">
    <img id="locationImg" src="{{ url_for('static', filename='images/' + location.image) }}" alt="{{ location.name }}" class="img-fluid">
    {% for it in items if it.pos_x is not none and it.pos_y is not none %}
      <div class="pin-icon" style="left: {{ it.pos_x }}%; top: {{ it.pos_y }}%;" data-id="{{ it.id }}" title="{{ it.name }}">
        ğŸ“
        <div class="pin-popup d-none" id="popup-{{ it.id }}">
          <div><strong><a href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.name }}</a></strong></div>
          {% if it.stock_status %}
            <div><span class="badge bg-secondary">çŠ¶æ€ï¼š{{ it.stock_status }}</span></div>
          {% endif %}
          {% if it.quantity %}
            <div>æ•°é‡ï¼š{{ it.quantity }}{% if it.unit %} {{ it.unit }}{% endif %}</div>
          {% endif %}
          {% if it.responsible_member %}
            <div>è´Ÿè´£äººï¼š<small>{{ it.responsible_member.name }}</small></div>
          {% endif %}
          {% if location.clean_status %}
          <p>å«ç”ŸçŠ¶æ€ï¼š
            <span class="badge 
                {% if location.clean_status == 'å¹²å‡€' %}bg-success
                {% elif location.clean_status == 'ä¸€èˆ¬' %}bg-warning text-dark
                {% elif location.clean_status == 'è„' %}bg-danger
                {% endif %}
              ">
                {{ location.clean_status }}
              </span>
            </p>
          {% endif %}
          {% if it.image %}
            <div class="mb-2">
              <img src="{{ url_for('static', filename='images/' + it.image) }}" alt="ç‰©å“å›¾ç‰‡" class="img-thumbnail" style="max-width:150px;">
            </div>
          {% endif %}
          {% if it.notes %}
            <div><small class="text-muted">å¤‡æ³¨ï¼š{{ it.notes|truncate(50) }}</small></div>
          {% endif %}
          {% if it.notes %}
            <div><small class="text-muted">å¤‡æ³¨ï¼š{{ it.notes|truncate(50) }}</small></div>
          {% endif %}
          <form method="post" action="{{ url_for('reset_item_position', item_id=it.id) }}">
            <input type="hidden" name="loc_id" value="{{ location.id }}">
            <button type="submit" class="btn btn-sm btn-outline-danger">é‡ç½®ä½ç½®</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

{% set unplaced_items = items|selectattr("pos_x", "==", none) | list %}
{% if unplaced_items %}
  <form method="post" action="{{ url_for('set_item_position', loc_id=location.id) }}" class="mb-4">
    <div class="row align-items-center">
      <div class="col-auto">
        <label for="itemSelect" class="form-label mb-0">æ ‡è®°æ–°ç‰©å“:</label>
      </div>
      <div class="col-auto">
        <select id="itemSelect" name="item_id" class="form-select">
          {% for it in unplaced_items %}
          <option value="{{ it.id }}">{{ it.name }}</option>
          {% endfor %}
        </select>
      </div>
      <input type="hidden" name="pos_x" id="posX">
      <input type="hidden" name="pos_y" id="posY">
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">ä¿å­˜ä½ç½®</button>
      </div>
      <div class="col-12">
        <small class="text-muted">ç‚¹å‡»ä¸Šæ–¹å›¾ç‰‡é€‰æ‹©ä½ç½®ï¼Œç„¶åç‚¹å‡»ä¿å­˜</small>
      </div>
    </div>
  </form>
{% endif %}
{% else %}
<p class="text-muted">æ— å›¾ç‰‡</p>
{% endif %}

<h5 class="mt-4">åŒ…å«çš„ç‰©å“</h5>
<ul class="list-group">
  {% for it in items %}
    <li class="list-group-item">
      <a href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.name }}</a>
      {% if it.stock_status %}
        <span class="badge bg-secondary">{{ it.stock_status }}</span>
      {% endif %}
      {% if it.responsible_member %}
        <small class="text-muted"> - {{ it.responsible_member.name }}</small>
      {% endif %}
    </li>
  {% else %}
    <li class="list-group-item text-muted">ï¼ˆæ­¤ä½ç½®æš‚æ— ç‰©å“ï¼‰</li>
  {% endfor %}
</ul>

<style>
  .pin-icon {
    position: absolute;
    transform: translate(-50%, -100%);
    cursor: pointer;
    font-size: 1.5rem;
    color: #e74c3c;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s, filter 0.2s;
  }

  .pin-icon:hover {
    transform: translate(-50%, -110%) scale(1.1);
    filter: brightness(1.2);
  }

  .pin-popup {
    position: absolute;
    top: -10px;
    left: 30px;
    background: #fff;
    border: 1px solid #ccc;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    z-index: 10;
    width: max-content;
    max-width: 240px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .pin-popup.d-none {
    display: none;
  }

  .pin-popup small {
    color: #888;
  }

  .pin-popup .badge {
    font-size: 0.75rem;
  }

  .pin-popup .btn {
    font-size: 0.75rem;
    padding: 0.2rem 0.6rem;
    margin-top: 0.5rem;
  }
</style>

<script>
  const img = document.getElementById('locationImg');
  const posXInput = document.getElementById('posX');
  const posYInput = document.getElementById('posY');

  if (img) {
    img.addEventListener('click', e => {
      const rect = img.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width) * 100;
      const y = ((e.clientY - rect.top) / rect.height) * 100;
      if (posXInput && posYInput) {
        posXInput.value = x.toFixed(2);
        posYInput.value = y.toFixed(2);
      }
    });
  }

  // å¼¹çª—é€»è¾‘ï¼šç‚¹å‡»å›¾é’‰æ˜¾ç¤ºä¿¡æ¯ï¼Œç‚¹å‡»ç©ºç™½éšè—
  document.querySelectorAll('.pin-icon').forEach(pin => {
    pin.addEventListener('click', (e) => {
      e.stopPropagation();
      document.querySelectorAll('.pin-popup').forEach(p => p.classList.add('d-none'));
      const popup = pin.querySelector('.pin-popup');
      if (popup) popup.classList.remove('d-none');
    });
  });

  document.addEventListener('click', () => {
    document.querySelectorAll('.pin-popup').forEach(p => p.classList.add('d-none'));
  });
</script>

{% endblock %}